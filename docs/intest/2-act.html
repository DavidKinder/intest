<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>2/gv</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
	</head>
	<body>

<!--Weave of '2/act' generated by 7-->
<ul class="crumbs"><li><a href="../webs.html">&#9733;</a></li><li><a href="index.html">intest 2.0</a></li><li><a href="index.html#2">Chapter 2: Test Cases and Instructions</a></li><li><b>Actions</b></li></ul><p class="purpose">To parse and carry out requests to do something.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. Reading the command line</a></li><li><a href="#SP6">&#167;6. Wildcards</a></li><li><a href="#SP7">&#167;7. Performance</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Reading the command line. </b>Suppose the tester invoked Intest as
</p>

<p class="inwebparagraph"></p>


<pre class="display">
        <span class="plain">$ intest/Tangled/intest inweb -bless plain twinprimes</span>
</pre>

<p class="inwebparagraph">The following routine will be called to take care of the actual command:
</p>

<p class="inwebparagraph"></p>


<pre class="display">
        <span class="plain">-bless plain twinprimes</span>
</pre>

<p class="inwebparagraph">The tokens <code class="display"><span class="extract">-bless</span></code>, <code class="display"><span class="extract">plain</span></code> and <code class="display"><span class="extract">twinprimes</span></code> will be in the array <code class="display"><span class="extract">argv</span></code>,
at indexes <code class="display"><span class="extract">from_arg_n</span></code> onwards. <code class="display"><span class="extract">to_arg_n</span></code> is the index after the last one.
The token list can contain multiple actions, one after the other.
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Actions::read_do_instructions</span><span class="plain">(</span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">,</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">from_arg_n</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">to_arg_n</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> **</span><span class="identifier">argv</span><span class="plain">) {</span>
        &lt;<span class="cwebmacro">Log the do instructions</span> <span class="cwebmacronumber">1.1</span>&gt;<span class="plain">;</span>

        <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">index</span><span class="plain">=</span><span class="identifier">from_arg_n</span><span class="plain">; </span><span class="identifier">index</span><span class="plain">&lt;</span><span class="identifier">to_arg_n</span><span class="plain">; </span><span class="identifier">index</span><span class="plain">++) {</span>
            <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">opt</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">index</span><span class="plain">];</span>

            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">TEST_ACTION</span><span class="plain">; </span>    <span class="comment">which command is used</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">ops_from</span><span class="plain"> = </span><span class="identifier">index</span><span class="plain">+1, </span><span class="identifier">ops_to</span><span class="plain"> = </span><span class="identifier">index</span><span class="plain">; </span>    <span class="comment">operands run from <code class="display"><span class="extract">ops_from</span></code> to <code class="display"><span class="extract">ops_to</span></code></span>
            <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">redirect_output</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">; </span>    <span class="comment">optional file to redirect output to</span>

            &lt;<span class="cwebmacro">Scan the command and advance index to the end of it</span> <span class="cwebmacronumber">1.2</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Translate the command into action item structures</span> <span class="cwebmacronumber">1.3</span>&gt;<span class="plain">;</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Actions::read_do_instructions is used in 1/cla (<a href="1-cla.html#SP2_1">&#167;2.1</a>).</p>

<p class="inwebparagraph"><a id="SP1_1"></a><b>&#167;1.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Log the do instructions</span> <span class="cwebmacronumber">1.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Log::aspect_switched_on</span><span class="plain">(</span><span class="constant">INSTRUCTIONS_DA</span><span class="plain">)) {</span>
            <span class="identifier">LOG</span><span class="plain">(</span><span class="string">"doing:"</span><span class="plain">);</span>
            <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=</span><span class="identifier">from_arg_n</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="identifier">to_arg_n</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++) </span><span class="identifier">LOG</span><span class="plain">(</span><span class="string">" %S"</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">]);</span>
            <span class="identifier">LOG</span><span class="plain">(</span><span class="string">"\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_2"></a><b>&#167;1.2.  </b>The <code class="display"><span class="extract">arity</span></code> is the expected number of operands which will follow the
command, or is <code class="display"><span class="extract">-1</span></code> to mean "any positive number of operands".
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Scan the command and advance index to the end of it</span> <span class="cwebmacronumber">1.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">pos</span><span class="plain"> = </span><span class="identifier">index</span><span class="plain"> + 1, </span><span class="identifier">arity</span><span class="plain"> = -1;</span>
        &lt;<span class="cwebmacro">Parse the command name</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">Scan for the operands</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">Parse an optional redirection filename</span> <span class="cwebmacronumber">1.2.3</span>&gt;<span class="plain">;</span>
        <span class="identifier">index</span><span class="plain"> = </span><span class="identifier">pos</span><span class="plain"> - 1;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_2_1"></a><b>&#167;1.2.1.  </b>A command begins with one of the following tokens: or, if it doesn't, we
pretend that it begins with <code class="display"><span class="extract">test</span></code>.
</p>

<p class="inwebparagraph">The following enumerates the "do commands", or as we'll call them in this
section, "actions":
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">BBDIFF_ACTION</span><span class="definitionkeyword"> from </span><span class="constant">1</span>
    <span class="definitionkeyword">enum</span> <span class="constant">BLESS_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">CATALOGUE_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">CENSUS_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">COMBINE_REPORTS_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">CONCORDANCE_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">CURSE_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">DIFF_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SOURCE_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">FIND_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">OPEN_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">REBLESS_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">REPORT_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SCRIPT_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SHOW_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SHOW_I6_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SKEIN_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">TEST_ACTION</span>
    <span class="definitionkeyword">define</span> <span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain"> 100 </span>    <span class="comment">must be more than all of the above</span>
</pre>

<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Parse the command name</span> <span class="cwebmacronumber">1.2.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-catalogue"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">CATALOGUE_ACTION</span><span class="plain">; </span><span class="identifier">arity</span><span class="plain"> = 0; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-find"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">FIND_ACTION</span><span class="plain">; </span><span class="identifier">arity</span><span class="plain"> = 1; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-test-skein"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">SKEIN_ACTION</span><span class="plain">; </span><span class="identifier">arity</span><span class="plain"> = 1; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-script"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">SCRIPT_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-source"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">SOURCE_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-concordance"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">CONCORDANCE_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-report"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">REPORT_ACTION</span><span class="plain">; </span><span class="identifier">arity</span><span class="plain"> = 5; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-combine"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">COMBINE_REPORTS_ACTION</span><span class="plain">; </span><span class="identifier">arity</span><span class="plain"> = 2; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-open"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">OPEN_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-show"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">SHOW_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-show-i6"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">SHOW_I6_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-bbdiff"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">BBDIFF_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-diff"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">DIFF_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-test"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">TEST_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-bless"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">BLESS_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-curse"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">CURSE_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-rebless"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">REBLESS_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, 0) == </span><span class="character">'-'</span><span class="plain">) </span><span class="functiontext">Errors::fatal_with_text</span><span class="plain">(</span><span class="string">"no such action as: %S"</span><span class="plain">, </span><span class="identifier">opt</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> { </span><span class="identifier">opt</span><span class="plain"> = </span><span class="identifier">I</span><span class="string">"-test"</span><span class="plain">; </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">TEST_ACTION</span><span class="plain">; </span><span class="identifier">pos</span><span class="plain"> = </span><span class="identifier">index</span><span class="plain">; }</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1_2">&#167;1.2</a>.</p>

<p class="inwebparagraph"><a id="SP1_2_2"></a><b>&#167;1.2.2.  </b>After the command, operands: e.g., in the token list <code class="display"><span class="extract">-bless A B -catalogue</span></code>,
the command <code class="display"><span class="extract">-bless</span></code> has two operands <code class="display"><span class="extract">A</span></code> and <code class="display"><span class="extract">B</span></code>. We know that <code class="display"><span class="extract">-catalogue</span></code>
is not an operand because it starts with a dash but is not a negative number.
(Thus, <code class="display"><span class="extract">-12</span></code> would be allowed as an operand, but <code class="display"><span class="extract">-minustwelve</span></code> would not.)
</p>

<p class="inwebparagraph">At this point <code class="display"><span class="extract">pos</span></code> is the index of the first operand. We must find the range
<code class="display"><span class="extract">ops_from</span></code> to <code class="display"><span class="extract">ops_to</span></code>.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Scan for the operands</span> <span class="cwebmacronumber">1.2.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">ops_from</span><span class="plain"> = </span><span class="identifier">pos</span><span class="plain">;</span>
        <span class="reserved">while</span><span class="plain"> (</span><span class="identifier">pos</span><span class="plain"> &lt; </span><span class="identifier">to_arg_n</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">pos</span><span class="plain">], 0) == </span><span class="character">'-'</span><span class="plain">) &amp;&amp;</span>
                <span class="plain">(!</span><span class="functiontext">Characters::isdigit</span><span class="plain">(</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">pos</span><span class="plain">], 1)))) </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="identifier">pos</span><span class="plain">++;</span>
        <span class="plain">}</span>
        <span class="identifier">ops_to</span><span class="plain"> = </span><span class="identifier">pos</span><span class="plain">-1;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">count</span><span class="plain"> = </span><span class="identifier">ops_to</span><span class="plain"> - </span><span class="identifier">ops_from</span><span class="plain"> + 1;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">arity</span><span class="plain"> &gt;= 0) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">count</span><span class="plain"> != </span><span class="identifier">arity</span><span class="plain">) {</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">arity</span><span class="plain"> == 0)</span>
                    <span class="functiontext">Errors::fatal_with_text</span><span class="plain">(</span><span class="string">"this action takes no case name(s): %S"</span><span class="plain">, </span><span class="identifier">opt</span><span class="plain">);</span>
                <span class="reserved">else</span><span class="plain"> {</span>
                    <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">);</span>
                    <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">, </span><span class="string">"the action '%S' takes %d parameters"</span><span class="plain">, </span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">arity</span><span class="plain">);</span>
                    <span class="functiontext">Errors::fatal_with_text</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">M</span><span class="plain">);</span>
                    <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">);</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">count</span><span class="plain"> == 0)</span>
                <span class="functiontext">Errors::fatal_with_text</span><span class="plain">(</span><span class="string">"this action must be followed by case name(s): %S"</span><span class="plain">, </span><span class="identifier">opt</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1_2">&#167;1.2</a>.</p>

<p class="inwebparagraph"><a id="SP1_2_3"></a><b>&#167;1.2.3.  </b>After the operands, there can optionally be <code class="display"><span class="extract">-to F</span></code>, where <code class="display"><span class="extract">F</span></code> is a filename.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Parse an optional redirection filename</span> <span class="cwebmacronumber">1.2.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">pos</span><span class="plain">+1 &lt; </span><span class="identifier">to_arg_n</span><span class="plain">) &amp;&amp; (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">pos</span><span class="plain">], </span><span class="identifier">I</span><span class="string">"-to"</span><span class="plain">))) {</span>
            <span class="identifier">redirect_output</span><span class="plain"> = </span><span class="functiontext">Filenames::from_text</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">pos</span><span class="plain">+1]);</span>
            <span class="identifier">pos</span><span class="plain"> += 2;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1_2">&#167;1.2</a>.</p>

<p class="inwebparagraph"><a id="SP1_3"></a><b>&#167;1.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Translate the command into action item structures</span> <span class="cwebmacronumber">1.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">assoc_text</span><span class="plain">);</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">assoc_number</span><span class="plain"> = 0, </span><span class="identifier">assoc_number2</span><span class="plain"> = 0;</span>
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">assoc_file1</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">, *</span><span class="identifier">assoc_file2</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">action</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">REPORT_ACTION</span><span class="plain">: </span>&lt;<span class="cwebmacro">Create action item for REPORT</span> <span class="cwebmacronumber">1.3.1</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">COMBINE_REPORTS_ACTION</span><span class="plain">: </span>&lt;<span class="cwebmacro">Create action item for COMBINE REPORTS</span> <span class="cwebmacronumber">1.3.2</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">FIND_ACTION</span><span class="plain">: </span>&lt;<span class="cwebmacro">Create action item for FIND</span> <span class="cwebmacronumber">1.3.3</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">SKEIN_ACTION</span><span class="plain">: </span>&lt;<span class="cwebmacro">Create action item for SKEIN</span> <span class="cwebmacronumber">1.3.4</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">default</span><span class="plain">: </span>&lt;<span class="cwebmacro">Create more typical action items</span> <span class="cwebmacronumber">1.3.5</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">assoc_text</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_3_1"></a><b>&#167;1.3.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Create action item for REPORT</span> <span class="cwebmacronumber">1.3.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1], </span><span class="identifier">I</span><span class="string">"i7"</span><span class="plain">)) </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="constant">I7_FAILED_OUTCOME</span><span class="plain">;</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1], </span><span class="identifier">I</span><span class="string">"i6"</span><span class="plain">)) </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="constant">I6_FAILED_OUTCOME</span><span class="plain">;</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1], </span><span class="identifier">I</span><span class="string">"cursed"</span><span class="plain">)) </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="constant">CURSED_OUTCOME</span><span class="plain">;</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1], </span><span class="identifier">I</span><span class="string">"wrong"</span><span class="plain">)) </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="constant">WRONG_TRANSCRIPT_OUTCOME</span><span class="plain">;</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1], </span><span class="identifier">I</span><span class="string">"right"</span><span class="plain">)) </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="constant">PERFECT_OUTCOME</span><span class="plain">;</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="functiontext">Errors::fatal_with_text</span><span class="plain">(</span>
            <span class="string">"expected 'i7', 'i6', 'wrong' or 'right' but found: %S"</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1]);</span>

        <span class="identifier">assoc_file1</span><span class="plain"> = </span><span class="functiontext">Filenames::from_text</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+2]);</span>
        <span class="identifier">assoc_text</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+3];</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">assoc_text</span><span class="plain">, 0) == </span><span class="character">'n'</span><span class="plain">) </span><span class="functiontext">Str::delete_first_character</span><span class="plain">(</span><span class="identifier">assoc_text</span><span class="plain">);</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">p</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+4];</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">p</span><span class="plain">, 0) == </span><span class="character">'t'</span><span class="plain">) </span><span class="identifier">assoc_number2</span><span class="plain"> = </span><span class="functiontext">Str::atoi</span><span class="plain">(</span><span class="identifier">p</span><span class="plain">, 1);</span>
        <span class="functiontext">Actions::create</span><span class="plain">(</span><span class="identifier">action</span><span class="plain">, </span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">], </span><span class="identifier">args</span><span class="plain">,</span>
            <span class="identifier">assoc_number</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="identifier">assoc_text</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1_3">&#167;1.3</a>.</p>

<p class="inwebparagraph"><a id="SP1_3_2"></a><b>&#167;1.3.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Create action item for COMBINE REPORTS</span> <span class="cwebmacronumber">1.3.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">assoc_file1</span><span class="plain"> = </span><span class="functiontext">Filenames::from_text</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">]);</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">p</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1];</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">p</span><span class="plain">, 0) == </span><span class="character">'-'</span><span class="plain">) </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="functiontext">Str::atoi</span><span class="plain">(</span><span class="identifier">p</span><span class="plain">, 1);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">assoc_number</span><span class="plain"> &lt;= 0)</span>
            <span class="functiontext">Errors::fatal_with_text</span><span class="plain">(</span>
                <span class="string">"expected dash then positive integer, e.g., '-5', but found: '%S'"</span><span class="plain">, </span><span class="identifier">p</span><span class="plain">);</span>
        <span class="functiontext">Actions::create</span><span class="plain">(</span><span class="identifier">action</span><span class="plain">, </span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">,</span>
            <span class="identifier">assoc_number</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="identifier">assoc_text</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1_3">&#167;1.3</a>.</p>

<p class="inwebparagraph"><a id="SP1_3_3"></a><b>&#167;1.3.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Create action item for FIND</span> <span class="cwebmacronumber">1.3.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">assoc_text</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">];</span>
        <span class="functiontext">Actions::create</span><span class="plain">(</span><span class="identifier">action</span><span class="plain">, </span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">,</span>
            <span class="identifier">assoc_number</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="identifier">assoc_text</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1_3">&#167;1.3</a>.</p>

<p class="inwebparagraph"><a id="SP1_3_4"></a><b>&#167;1.3.4.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Create action item for SKEIN</span> <span class="cwebmacronumber">1.3.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">assoc_file1</span><span class="plain"> = </span><span class="functiontext">Filenames::from_text</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">]);</span>
        <span class="identifier">assoc_text</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1];</span>
        <span class="functiontext">Actions::create</span><span class="plain">(</span><span class="identifier">action</span><span class="plain">, </span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">,</span>
            <span class="identifier">assoc_number</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="identifier">assoc_text</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1_3">&#167;1.3</a>.</p>

<p class="inwebparagraph"><a id="SP1_3_5"></a><b>&#167;1.3.5.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Create more typical action items</span> <span class="cwebmacronumber">1.3.5</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ops_to</span><span class="plain"> &gt;= </span><span class="identifier">ops_from</span><span class="plain">)</span>
            <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">j</span><span class="plain"> = </span><span class="identifier">ops_from</span><span class="plain">; </span><span class="identifier">j</span><span class="plain"> &lt;= </span><span class="identifier">ops_to</span><span class="plain">; </span><span class="identifier">j</span><span class="plain">++)</span>
                <span class="functiontext">Actions::create</span><span class="plain">(</span><span class="identifier">action</span><span class="plain">, </span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">j</span><span class="plain">], </span><span class="identifier">args</span><span class="plain">,</span>
                    <span class="identifier">assoc_number</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="identifier">assoc_text</span><span class="plain">);</span>
        <span class="reserved">else</span>
            <span class="functiontext">Actions::create</span><span class="plain">(</span><span class="identifier">action</span><span class="plain">, </span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">,</span>
                <span class="identifier">assoc_number</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="identifier">assoc_text</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1_3">&#167;1.3</a>.</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b>So, then, a command such as <code class="display"><span class="extract">-test alpha beta gamma</span></code> will cause three
instances of the "action item" structure to be created, of type <code class="display"><span class="extract">TEST_ACTION</span></code>
on <code class="display"><span class="extract">alpha</span></code>, <code class="display"><span class="extract">beta</span></code> and <code class="display"><span class="extract">gamma</span></code> respectively.
</p>


<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">action_item</span><span class="plain"> {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">action_type</span><span class="plain">; </span>    <span class="comment">one of the <code class="display"><span class="extract">_ACTION</span></code> cases above</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">test_form</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">case_specifier</span><span class="plain"> </span><span class="identifier">operand</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">redirection_filename</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">assoc_number</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">assoc_number2</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">assoc_file1</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">assoc_file2</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">assoc_text</span><span class="plain">;</span>
        <span class="constant">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">action_item</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure action_item is accessed in 3/ts, 3/tr and here.</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>As each action item is created, it is added to the "to-do list" for this
run of Intest. (There is just one global to-do list.)
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Actions::create</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">action</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">op</span><span class="plain">, </span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">,</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">assoc_number</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">) {</span>
        <span class="reserved">action_item</span><span class="plain"> *</span><span class="identifier">ai</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">action_item</span><span class="plain">);</span>
        <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain"> = </span><span class="identifier">action</span><span class="plain">;</span>
        <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;redirection_filename</span><span class="plain"> = </span><span class="identifier">redirect_output</span><span class="plain">;</span>
        <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;assoc_number</span><span class="plain"> = </span><span class="identifier">assoc_number</span><span class="plain">;</span>
        <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;assoc_number2</span><span class="plain"> = </span><span class="identifier">assoc_number2</span><span class="plain">;</span>
        <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;assoc_file1</span><span class="plain"> = </span><span class="identifier">assoc_file1</span><span class="plain">;</span>
        <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;assoc_file2</span><span class="plain"> = </span><span class="identifier">assoc_file2</span><span class="plain">;</span>
        <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;assoc_text</span><span class="plain"> = </span><span class="functiontext">Str::duplicate</span><span class="plain">(</span><span class="identifier">text</span><span class="plain">);</span>
        <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;operand</span><span class="plain"> = </span><span class="functiontext">Actions::parse_specifier</span><span class="plain">(</span><span class="identifier">op</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">);</span>

        <span class="identifier">ADD_TO_LINKED_LIST</span><span class="plain">(</span><span class="identifier">ai</span><span class="plain">, </span><span class="reserved">action_item</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;to_do_list</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Actions::create is used in <a href="#SP1_3_1">&#167;1.3.1</a>, <a href="#SP1_3_2">&#167;1.3.2</a>, <a href="#SP1_3_3">&#167;1.3.3</a>, <a href="#SP1_3_4">&#167;1.3.4</a>, <a href="#SP1_3_5">&#167;1.3.5</a>.</p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4.  </b>A "case specifier" says what case(s) an action should apply to, and this
can involve a wildcard such as <code class="display"><span class="extract">all</span></code>:
</p>


<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">case_specifier</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">specific_case</span><span class="plain">; </span>    <span class="comment">a specific test to apply to...</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">wild_card</span><span class="plain">; </span>    <span class="comment">...or a wildcard</span>
    <span class="plain">} </span><span class="reserved">case_specifier</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure case_specifier is private to this section.</p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5.  </b></p>


<pre class="display">
    <span class="reserved">case_specifier</span><span class="plain"> </span><span class="functiontext">Actions::parse_specifier</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">token</span><span class="plain">, </span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">) {</span>
        <span class="reserved">case_specifier</span><span class="plain"> </span><span class="identifier">cs</span><span class="plain">;</span>
        <span class="identifier">cs</span><span class="element">.wild_card</span><span class="plain"> = </span><span class="functiontext">Actions::identify_wildcard</span><span class="plain">(</span><span class="identifier">token</span><span class="plain">);</span>
        <span class="identifier">cs</span><span class="element">.specific_case</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">token</span><span class="plain">) &amp;&amp; (</span><span class="identifier">cs</span><span class="element">.wild_card</span><span class="plain"> == </span><span class="constant">TAMECARD</span><span class="plain">)) {</span>
            <span class="identifier">cs</span><span class="element">.specific_case</span><span class="plain"> = </span><span class="functiontext">RecipeFiles::find_case</span><span class="plain">(</span><span class="identifier">args</span><span class="plain">, </span><span class="identifier">token</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">cs</span><span class="element">.specific_case</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">)</span>
                <span class="functiontext">Errors::fatal_with_text</span><span class="plain">(</span><span class="string">"no such test case as %S"</span><span class="plain">, </span><span class="identifier">token</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">cs</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Actions::parse_specifier is used in <a href="#SP3">&#167;3</a>.</p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6. Wildcards. </b></p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">COUNT_WILDCARD_BASE</span><span class="plain"> 1001 </span>    <span class="comment">1001 is <code class="display"><span class="extract">^1</span></code>, 1002 is <code class="display"><span class="extract">^2</span></code>, ...</span>
    <span class="definitionkeyword">define</span> <span class="constant">EXTENSION_WILDCARD_BASE</span><span class="plain"> 1 </span>    <span class="comment">1 is <code class="display"><span class="extract">A</span></code>, 2 is <code class="display"><span class="extract">B</span></code>, ...</span>
    <span class="definitionkeyword">define</span> <span class="constant">TAMECARD</span><span class="plain"> 0</span>
    <span class="definitionkeyword">define</span> <span class="constant">ALL_WILDCARD</span><span class="plain"> -1</span>
    <span class="definitionkeyword">define</span> <span class="constant">EXAMPLES_WILDCARD</span><span class="plain"> -2</span>
    <span class="definitionkeyword">define</span> <span class="constant">CASES_WILDCARD</span><span class="plain"> -3</span>
    <span class="definitionkeyword">define</span> <span class="constant">PROBLEMS_WILDCARD</span><span class="plain"> -4</span>
    <span class="definitionkeyword">define</span> <span class="constant">EXTENSIONS_WILDCARD</span><span class="plain"> -5</span>
    <span class="definitionkeyword">define</span> <span class="constant">MAPS_WILDCARD</span><span class="plain"> -6</span>
</pre>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Actions::identify_wildcard</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">token</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">token</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">TAMECARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">token</span><span class="plain">) == 1) {</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">token</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> &gt;= </span><span class="character">'A'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">c</span><span class="plain"> &lt;= </span><span class="character">'Z'</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> - </span><span class="character">'A'</span><span class="plain"> + </span><span class="constant">EXTENSION_WILDCARD_BASE</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> &gt;= </span><span class="character">'a'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">c</span><span class="plain"> &lt;= </span><span class="character">'z'</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> - </span><span class="character">'a'</span><span class="plain"> + </span><span class="constant">EXTENSION_WILDCARD_BASE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"all"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">ALL_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"examples"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">EXAMPLES_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"cases"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">CASES_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"problems"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">PROBLEMS_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"maps"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">MAPS_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"extensions"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">EXTENSIONS_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">token</span><span class="plain">) == </span><span class="character">'^'</span><span class="plain">) {</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">n</span><span class="plain"> = </span><span class="functiontext">Str::atoi</span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, 1);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">n</span><span class="plain"> &gt; 0) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">n</span><span class="plain"> - 1 + </span><span class="constant">COUNT_WILDCARD_BASE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="constant">TAMECARD</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Actions::matches_wildcard</span><span class="plain">(</span><span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">w</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">w</span><span class="plain"> == </span><span class="constant">ALL_WILDCARD</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">w</span><span class="plain"> == </span><span class="functiontext">Actions::which_wildcard</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Actions::which_wildcard</span><span class="plain">(</span><span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;format_reference</span><span class="plain"> == </span><span class="constant">EXAMPLE_FORMAT</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">EXAMPLES_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_type</span><span class="plain"> == </span><span class="constant">PROBLEM_SPT</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">PROBLEMS_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_type</span><span class="plain"> == </span><span class="constant">MAP_SPT</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">MAPS_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;format_reference</span><span class="plain"> == </span><span class="constant">EXTENSION_FORMAT</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">EXTENSIONS_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="constant">CASES_WILDCARD</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">char</span><span class="plain"> *</span><span class="functiontext">Actions::name_of_wildcard</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">w</span><span class="plain">) {</span>
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">w</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">EXAMPLES_WILDCARD</span><span class="plain">: </span><span class="reserved">return</span><span class="plain"> </span><span class="string">"examples"</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">EXTENSIONS_WILDCARD</span><span class="plain">: </span><span class="reserved">return</span><span class="plain"> </span><span class="string">"extensions"</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">PROBLEMS_WILDCARD</span><span class="plain">: </span><span class="reserved">return</span><span class="plain"> </span><span class="string">"problems"</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">MAPS_WILDCARD</span><span class="plain">: </span><span class="reserved">return</span><span class="plain"> </span><span class="string">"maps"</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">CASES_WILDCARD</span><span class="plain">: </span><span class="reserved">return</span><span class="plain"> </span><span class="string">"cases"</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="string">"?"</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Actions::identify_wildcard is used in <a href="#SP5">&#167;5</a>, 2/rf (<a href="2-rf.html#SP5">&#167;5</a>).</p>

<p class="endnote">The function Actions::matches_wildcard is used in <a href="#SP7_1_3">&#167;7.1.3</a>.</p>

<p class="endnote">The function Actions::which_wildcard is used in 3/ts (<a href="3-ts.html#SP9_3_2">&#167;9.3.2</a>).</p>

<p class="endnote">The function Actions::name_of_wildcard is used in 3/ts (<a href="3-ts.html#SP9_3_2">&#167;9.3.2</a>).</p>

<p class="inwebparagraph"><a id="SP7"></a><b>&#167;7. Performance. </b>At this point, parsing is long over. We have to perform the actions in the
to-do list:
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Actions::perform</span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">) {</span>
        <span class="functiontext">Hasher::read_hashes</span><span class="plain">(</span><span class="identifier">args</span><span class="plain">);</span>
        <span class="functiontext">Scheduler::start</span><span class="plain">(</span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;threads_available</span><span class="plain">);</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">count</span><span class="plain"> = 1;</span>
        <span class="reserved">action_item</span><span class="plain"> *</span><span class="identifier">ai</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">ai</span><span class="plain">, </span><span class="reserved">action_item</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;to_do_list</span><span class="plain">)</span>
            &lt;<span class="cwebmacro">Perform this action item</span> <span class="cwebmacronumber">7.1</span>&gt;<span class="plain">;</span>

        <span class="functiontext">Scheduler::test</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
        <span class="functiontext">Hasher::write_hashes</span><span class="plain">();</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Actions::perform is used in 1/mn (<a href="1-mn.html#SP1_4">&#167;1.4</a>).</p>

<p class="inwebparagraph"><a id="SP7_1"></a><b>&#167;7.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perform this action item</span> <span class="cwebmacronumber">7.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;operand.wild_card</span><span class="plain"> &gt;= </span><span class="constant">COUNT_WILDCARD_BASE</span><span class="plain">) </span>&lt;<span class="cwebmacro">Perform this counted case</span> <span class="cwebmacronumber">7.1.1</span>&gt;
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;operand.wild_card</span><span class="plain"> &gt;= </span><span class="constant">EXTENSION_WILDCARD_BASE</span><span class="plain">) </span>&lt;<span class="cwebmacro">Perform this lettered case</span> <span class="cwebmacronumber">7.1.2</span>&gt;
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;operand.wild_card</span><span class="plain"> == </span><span class="constant">TAMECARD</span><span class="plain">)</span>
            <span class="functiontext">Actions::perform_inner</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;operand.specific_case</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">++);</span>
        <span class="reserved">else</span><span class="plain"> </span>&lt;<span class="cwebmacro">Perform this matched case</span> <span class="cwebmacronumber">7.1.3</span>&gt;<span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7">&#167;7</a>.</p>

<p class="inwebparagraph"><a id="SP7_1_1"></a><b>&#167;7.1.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perform this counted case</span> <span class="cwebmacronumber">7.1.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">find_count</span><span class="plain"> = 0;</span>
        <span class="reserved">search_path_item</span><span class="plain"> *</span><span class="identifier">spi</span><span class="plain">;</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">spi</span><span class="plain">, </span><span class="reserved">search_path_item</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;search_path</span><span class="plain">)</span>
            <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">spi</span><span class="plain">-</span><span class="element">&gt;contents</span><span class="plain">)</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">find_count</span><span class="plain">++ == </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;operand.wild_card</span><span class="plain"> - </span><span class="constant">COUNT_WILDCARD_BASE</span><span class="plain">) {</span>
                    <span class="functiontext">Actions::perform_inner</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">++);</span>
                    <span class="reserved">goto</span><span class="plain"> </span><span class="identifier">ExitCountSearch</span><span class="plain">;</span>
                <span class="plain">}</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">find_count</span><span class="plain"> == 0)</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">, </span><span class="string">"there were no cases here at all"</span><span class="plain">);</span>
        <span class="reserved">else</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">, </span><span class="string">"cases only run from ^1 to ^%d"</span><span class="plain">, </span><span class="identifier">find_count</span><span class="plain">);</span>
        <span class="functiontext">Errors::fatal_with_text</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">M</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">);</span>
        <span class="identifier">ExitCountSearch</span><span class="plain">: ;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7_1">&#167;7.1</a>.</p>

<p class="inwebparagraph"><a id="SP7_1_2"></a><b>&#167;7.1.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perform this lettered case</span> <span class="cwebmacronumber">7.1.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">search_path_item</span><span class="plain"> *</span><span class="identifier">spi</span><span class="plain">;</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">spi</span><span class="plain">, </span><span class="reserved">search_path_item</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;search_path</span><span class="plain">)</span>
            <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">spi</span><span class="plain">-</span><span class="element">&gt;contents</span><span class="plain">)</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;format_reference</span><span class="plain"> == </span><span class="constant">EXTENSION_FORMAT</span><span class="plain">) &amp;&amp;</span>
                    <span class="plain">(</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;letter_reference</span><span class="plain"> ==</span>
                        <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;operand.wild_card</span><span class="plain"> - </span><span class="constant">EXTENSION_WILDCARD_BASE</span><span class="plain"> + 1)) {</span>
                    <span class="functiontext">Actions::perform_inner</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">++);</span>
                    <span class="reserved">goto</span><span class="plain"> </span><span class="identifier">ExitLetterSearch</span><span class="plain">;</span>
                <span class="plain">}</span>
        <span class="functiontext">Errors::fatal</span><span class="plain">(</span><span class="string">"unable to find any such extension example"</span><span class="plain">);</span>
        <span class="identifier">ExitLetterSearch</span><span class="plain">: ;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7_1">&#167;7.1</a>.</p>

<p class="inwebparagraph"><a id="SP7_1_3"></a><b>&#167;7.1.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perform this matched case</span> <span class="cwebmacronumber">7.1.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">search_path_item</span><span class="plain"> *</span><span class="identifier">spi</span><span class="plain">;</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">spi</span><span class="plain">, </span><span class="reserved">search_path_item</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;search_path</span><span class="plain">)</span>
            <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">spi</span><span class="plain">-</span><span class="element">&gt;contents</span><span class="plain">)</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Actions::matches_wildcard</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;operand.wild_card</span><span class="plain">)) {</span>
                    <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;test_form</span><span class="plain"> = </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain">;</span>
                    <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain"> += </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">;</span>
                    <span class="functiontext">Actions::perform_inner</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">++);</span>
                    <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain"> -= </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">;</span>
                <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP7_1">&#167;7.1</a>.</p>

<p class="inwebparagraph"><a id="SP8"></a><b>&#167;8.  </b>And now we can forget everything about wild cards: we know for definite
which test case to work on.
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Actions::perform_inner</span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">,</span>
        <span class="reserved">action_item</span><span class="plain"> *</span><span class="identifier">ai</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">itc</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">count</span><span class="plain">) {</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">TO</span><span class="plain"> = </span><span class="identifier">OUT</span><span class="plain">;</span>
        <span class="reserved">text_stream</span><span class="plain"> </span><span class="identifier">TO_struct</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain"> &lt; </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">) &amp;&amp; (</span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;redirection_filename</span><span class="plain">)) {</span>
            <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;redirection_filename</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">itc</span><span class="plain">) </span>&lt;<span class="cwebmacro">Expand NAME and NUMBER in the redirection filename</span> <span class="cwebmacronumber">8.1</span>&gt;<span class="plain">;</span>
            <span class="identifier">TO</span><span class="plain"> = &amp;</span><span class="identifier">TO_struct</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">STREAM_OPEN_TO_FILE</span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">, </span><span class="constant">UTF8_ENC</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
                <span class="functiontext">Errors::fatal_with_file</span><span class="plain">(</span><span class="string">"unable to write file"</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">);</span>
        <span class="plain">}</span>
        &lt;<span class="cwebmacro">Finally do something, or at leask ask somebody else to</span> <span class="cwebmacronumber">8.2</span>&gt;<span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain"> &lt; </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">) &amp;&amp; (</span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;redirection_filename</span><span class="plain">)) </span><span class="identifier">STREAM_CLOSE</span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Actions::perform_inner is used in <a href="#SP7_1">&#167;7.1</a>, <a href="#SP7_1_1">&#167;7.1.1</a>, <a href="#SP7_1_2">&#167;7.1.2</a>, <a href="#SP7_1_3">&#167;7.1.3</a>.</p>

<p class="inwebparagraph"><a id="SP8_1"></a><b>&#167;8.1.  </b>If the leafname of the redirection file is <code class="display"><span class="extract">something_[NUMBER]</span></code> then we
substitute in the case number for <code class="display"><span class="extract">[NUMBER]</span></code>, and similarly for <code class="display"><span class="extract">[NAME]</span></code>.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Expand NAME and NUMBER in the redirection filename</span> <span class="cwebmacronumber">8.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">);</span>
        <span class="identifier">leaf</span><span class="plain"> = </span><span class="functiontext">Str::duplicate</span><span class="plain">(</span><span class="functiontext">Filenames::get_leafname</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">));</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
        <span class="reserved">while</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">leaf</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*?)%[NAME%](%c*)"</span><span class="plain">)) {</span>
            <span class="functiontext">Str::clear</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">);</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">, </span><span class="string">"%S%s%S"</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0], </span><span class="identifier">itc</span><span class="plain">-</span><span class="element">&gt;test_case_name</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[1]);</span>
        <span class="plain">}</span>
        <span class="reserved">while</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">leaf</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*?)%[NUMBER%](%c*)"</span><span class="plain">)) {</span>
            <span class="functiontext">Str::clear</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">);</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">, </span><span class="string">"%S%d%S"</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0], </span><span class="identifier">count</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[1]);</span>
        <span class="plain">}</span>
        <span class="identifier">F</span><span class="plain"> = </span><span class="functiontext">Filenames::in_folder</span><span class="plain">(</span><span class="functiontext">Filenames::get_path_to</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">), </span><span class="identifier">leaf</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">);</span>
        <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP8">&#167;8</a>.</p>

<p class="inwebparagraph"><a id="SP8_2"></a><b>&#167;8.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Finally do something, or at leask ask somebody else to</span> <span class="cwebmacronumber">8.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">CATALOGUE_ACTION</span><span class="plain">:</span>
                <span class="functiontext">RecipeFiles::perform_catalogue</span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;search_path</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">FIND_ACTION</span><span class="plain">:</span>
                <span class="functiontext">RecipeFiles::perform_catalogue</span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;search_path</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;assoc_text</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">SOURCE_ACTION</span><span class="plain">:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">CONCORDANCE_ACTION</span><span class="plain">:</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">itc</span><span class="plain">)</span>
                    <span class="functiontext">Extractor::run</span><span class="plain">(</span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">-</span><span class="element">&gt;test_location</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">-</span><span class="element">&gt;format_reference</span><span class="plain">,</span>
                        <span class="identifier">itc</span><span class="plain">-</span><span class="element">&gt;letter_reference</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
                <span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">SCRIPT_ACTION</span><span class="plain">:</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">itc</span><span class="plain">) {</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">TextFiles::exists</span><span class="plain">(</span><span class="identifier">itc</span><span class="plain">-</span><span class="element">&gt;commands_location</span><span class="plain">))</span>
                        <span class="functiontext">Extractor::run</span><span class="plain">(</span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">-</span><span class="element">&gt;commands_location</span><span class="plain">, </span><span class="constant">PLAIN_FORMAT</span><span class="plain">,</span>
                            <span class="plain">0, </span><span class="constant">SOURCE_ACTION</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
                    <span class="reserved">else</span>
                        <span class="functiontext">Extractor::run</span><span class="plain">(</span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">-</span><span class="element">&gt;test_location</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">-</span><span class="element">&gt;format_reference</span><span class="plain">,</span>
                            <span class="identifier">itc</span><span class="plain">-</span><span class="element">&gt;letter_reference</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
                <span class="plain">}</span>
                <span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">OPEN_ACTION</span><span class="plain">:</span>
                <span class="functiontext">Shell::apply</span><span class="plain">(</span><span class="string">"open"</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">-</span><span class="element">&gt;test_location</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">BBDIFF_ACTION</span><span class="plain">:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">DIFF_ACTION</span><span class="plain">:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">TEST_ACTION</span><span class="plain">:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">BLESS_ACTION</span><span class="plain">:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">CURSE_ACTION</span><span class="plain">:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">SHOW_ACTION</span><span class="plain">:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">SHOW_I6_ACTION</span><span class="plain">:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">REBLESS_ACTION</span><span class="plain">:</span>
                <span class="functiontext">Tester::test</span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">, -1, </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">REPORT_ACTION</span><span class="plain">:</span>
                <span class="functiontext">Reporter::report_single</span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">COMBINE_REPORTS_ACTION</span><span class="plain">:</span>
                <span class="functiontext">Reporter::combine</span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;assoc_number</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;assoc_file1</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">SKEIN_ACTION</span><span class="plain">:</span>
                <span class="functiontext">Skeins::test_i7_skein</span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;assoc_file1</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;assoc_text</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">default</span><span class="plain">:</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain"> &gt;= </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">) {</span>
                    <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain"> -= </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">;</span>
                    <span class="functiontext">Scheduler::schedule</span><span class="plain">(</span><span class="identifier">itc</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;redirection_filename</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;test_form</span><span class="plain">);</span>
                    <span class="identifier">ai</span><span class="plain">-</span><span class="element">&gt;action_type</span><span class="plain"> += </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">;</span>
                    <span class="reserved">break</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"unimplemented action"</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP8">&#167;8</a>.</p>

<hr class="tocbar">
<ul class="toc"><li><a href="2-gv.html">Back to 'Global Variables'</a></li><li><a href="2-th.html">Continue with 'The Historian'</a></li></ul><hr class="tocbar">
<!--End of weave-->
	</body>
</html>

