<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Actions</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../index.html">
<img src="../docs-src/Figures/Intest.png" height=72">
</a></h1>
<ul><li><a href="index.html"><span class="selectedlink">intest</span></a></li>
</ul><h2>Foundation Module</h2><ul>
<li><a href="../../../inweb/docs/foundation-module/index.html">foundation</a></li>
</ul><h2>Repository</h2><ul>
<li><a href="https://github.com/ganelson/intest"><img src="../github.png" height=18> github</a></li>
</ul><h2>Related Projects</h2><ul>
<li><a href="../../../inweb/docs/index.html">inweb</a></li>
<li><a href="../../../inform/docs/index.html">inform</a></li>

</ul>
		</nav>
		<main role="main">
		
<!--Weave of 'Actions' generated by 7-->
<ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">intest</a></li><li><a href="index.html#2">Chapter 2: Test Cases and Instructions</a></li><li><b>Actions</b></li></ul><p class="purpose">To parse and carry out requests to do something.</p>

<ul class="toc"><li><a href="2-act.html#SP1">&#167;1. Reading the command line</a></li><li><a href="2-act.html#SP6">&#167;6. Wildcards</a></li><li><a href="2-act.html#SP7">&#167;7. Performance</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Reading the command line. </b>Suppose the tester invoked Intest as
</p>

<pre class="display">
        <span class="element">$</span><span class="plain"> </span><span class="functiontext">intest/Tangled/intest</span><span class="plain"> inweb</span><span class="identifier"> -bless</span><span class="plain"> plain twinprimes</span>
</pre>

<p class="inwebparagraph">The following routine will be called to take care of the actual command:
</p>

<pre class="display">
        <span class="plain">-bless plain twinprimes</span>
</pre>

<p class="inwebparagraph">The tokens <code class="display"><span class="extract">-bless</span></code>, <code class="display"><span class="extract">plain</span></code> and <code class="display"><span class="extract">twinprimes</span></code> will be in the array <code class="display"><span class="extract">argv</span></code>,
at indexes <code class="display"><span class="extract">from_arg_n</span></code> onwards. <code class="display"><span class="extract">to_arg_n</span></code> is the index after the last one.
The token list can contain multiple actions, one after the other.
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Actions::read_do_instructions<button class="popup" onclick="togglePopup('usagePopup26')">...<span class="popuptext" id="usagePopup26">Usage of <b>Actions::read_do_instructions</b>:<br>Command Line Arguments - <a href="1-cla.html#SP2_1">&#167;2.1</a></span></button></span><span class="plain">(</span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">,</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">from_arg_n</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">to_arg_n</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> **</span><span class="identifier">argv</span><span class="plain">) {</span>
        &lt;<span class="cwebmacro">Log the do instructions</span> <span class="cwebmacronumber">1.1</span>&gt;<span class="plain">;</span>

        <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">index</span><span class="plain">=</span><span class="identifier">from_arg_n</span><span class="plain">; </span><span class="identifier">index</span><span class="plain">&lt;</span><span class="identifier">to_arg_n</span><span class="plain">; </span><span class="identifier">index</span><span class="plain">++) {</span>
            <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">opt</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">index</span><span class="plain">];</span>

            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">TEST_ACTION</span><span class="plain">; </span><span class="comment"> which command is used</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">ops_from</span><span class="plain"> = </span><span class="identifier">index</span><span class="plain">+1, </span><span class="identifier">ops_to</span><span class="plain"> = </span><span class="identifier">index</span><span class="plain">; </span><span class="comment"> operands run from <code class="display"><span class="extract">ops_from</span></code> to <code class="display"><span class="extract">ops_to</span></code></span>
            <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">redirect_output</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">; </span><span class="comment"> optional file to redirect output to</span>

            &lt;<span class="cwebmacro">Scan the command and advance index to the end of it</span> <span class="cwebmacronumber">1.2</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Translate the command into action item structures</span> <span class="cwebmacronumber">1.3</span>&gt;<span class="plain">;</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP1_1"></a><b>&#167;1.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Log the do instructions</span> <span class="cwebmacronumber">1.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/2-dl.html#SP7">Log::aspect_switched_on</a></span><span class="plain">(</span><span class="constant">INSTRUCTIONS_DA</span><span class="plain">)) {</span>
            <span class="identifier">LOG</span><span class="plain">(</span><span class="string">"doing:"</span><span class="plain">);</span>
            <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=</span><span class="identifier">from_arg_n</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="identifier">to_arg_n</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++) </span><span class="identifier">LOG</span><span class="plain">(</span><span class="string">" %S"</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">]);</span>
            <span class="identifier">LOG</span><span class="plain">(</span><span class="string">"\n"</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_2"></a><b>&#167;1.2.  </b>The <code class="display"><span class="extract">arity</span></code> is the expected number of operands which will follow the
command, or is <code class="display"><span class="extract">-1</span></code> to mean "any positive number of operands".
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Scan the command and advance index to the end of it</span> <span class="cwebmacronumber">1.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">pos</span><span class="plain"> = </span><span class="identifier">index</span><span class="plain"> + </span><span class="constant">1</span><span class="plain">, </span><span class="identifier">arity</span><span class="plain"> = -1;</span>
        &lt;<span class="cwebmacro">Parse the command name</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">Scan for the operands</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">Parse an optional redirection filename</span> <span class="cwebmacronumber">1.2.3</span>&gt;<span class="plain">;</span>
        <span class="identifier">index</span><span class="plain"> = </span><span class="identifier">pos</span><span class="plain"> - </span><span class="constant">1</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_2_1"></a><b>&#167;1.2.1.  </b>A command begins with one of the following tokens: or, if it doesn't, we
pretend that it begins with <code class="display"><span class="extract">test</span></code>.
</p>

<p class="inwebparagraph">The following enumerates the "do commands", or as we'll call them in this
section, "actions":
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">BBDIFF_ACTION</span><span class="definitionkeyword"> from </span><span class="constant">1</span>
    <span class="definitionkeyword">enum</span> <span class="constant">BLESS_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">CATALOGUE_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">CENSUS_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">COMBINE_REPORTS_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">CONCORDANCE_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">CURSE_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">DEBUGGER_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">DIFF_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SOURCE_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">FIND_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">OPEN_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">REBLESS_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">REPORT_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SCRIPT_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SHOW_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SHOW_I6_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SHOW_TRANSCRIPT_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SKEIN_ACTION</span>
    <span class="definitionkeyword">enum</span> <span class="constant">TEST_ACTION</span>
    <span class="definitionkeyword">define</span> <span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain"> </span><span class="constant">100</span><span class="plain"> </span><span class="comment"> must be more than all of the above</span>
</pre>

<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Parse the command name</span> <span class="cwebmacronumber">1.2.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-catalogue"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">CATALOGUE_ACTION</span><span class="plain">; </span><span class="identifier">arity</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-find"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">FIND_ACTION</span><span class="plain">; </span><span class="identifier">arity</span><span class="plain"> = </span><span class="constant">1</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-test-skein"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">SKEIN_ACTION</span><span class="plain">; </span><span class="identifier">arity</span><span class="plain"> = </span><span class="constant">1</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-script"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">SCRIPT_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-source"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">SOURCE_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-concordance"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">CONCORDANCE_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-report"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">REPORT_ACTION</span><span class="plain">; </span><span class="identifier">arity</span><span class="plain"> = </span><span class="constant">5</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-combine"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">COMBINE_REPORTS_ACTION</span><span class="plain">; </span><span class="identifier">arity</span><span class="plain"> = </span><span class="constant">2</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-open"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">OPEN_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-show"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">SHOW_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-show-i6"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">SHOW_I6_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-show-t"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">SHOW_TRANSCRIPT_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-bbdiff"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">BBDIFF_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-diff"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">DIFF_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-test"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">TEST_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-debug"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">DEBUGGER_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-bless"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">BLESS_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-curse"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">CURSE_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-rebless"</span><span class="plain">)) { </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">REBLESS_ACTION</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="constant">0</span><span class="plain">) == </span><span class="character">'-'</span><span class="plain">) </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-em.html#SP2">Errors::fatal_with_text</a></span><span class="plain">(</span><span class="string">"no such action as: %S"</span><span class="plain">, </span><span class="identifier">opt</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> { </span><span class="identifier">opt</span><span class="plain"> = </span><span class="identifier">I</span><span class="string">"-test"</span><span class="plain">; </span><span class="identifier">action</span><span class="plain"> = </span><span class="constant">TEST_ACTION</span><span class="plain">; </span><span class="identifier">pos</span><span class="plain"> = </span><span class="identifier">index</span><span class="plain">; }</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP1_2">&#167;1.2</a>.</p>

<p class="inwebparagraph"><a id="SP1_2_2"></a><b>&#167;1.2.2.  </b>After the command, operands: e.g., in the token list <code class="display"><span class="extract">-bless A B -catalogue</span></code>,
the command <code class="display"><span class="extract">-bless</span></code> has two operands <code class="display"><span class="extract">A</span></code> and <code class="display"><span class="extract">B</span></code>. We know that <code class="display"><span class="extract">-catalogue</span></code>
is not an operand because it starts with a dash but is not a negative number.
(Thus, <code class="display"><span class="extract">-12</span></code> would be allowed as an operand, but <code class="display"><span class="extract">-minustwelve</span></code> would not.)
</p>

<p class="inwebparagraph">At this point <code class="display"><span class="extract">pos</span></code> is the index of the first operand. We must find the range
<code class="display"><span class="extract">ops_from</span></code> to <code class="display"><span class="extract">ops_to</span></code>.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Scan for the operands</span> <span class="cwebmacronumber">1.2.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">ops_from</span><span class="plain"> = </span><span class="identifier">pos</span><span class="plain">;</span>
        <span class="reserved">while</span><span class="plain"> (</span><span class="identifier">pos</span><span class="plain"> &lt; </span><span class="identifier">to_arg_n</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">pos</span><span class="plain">], </span><span class="constant">0</span><span class="plain">) == </span><span class="character">'-'</span><span class="plain">) &amp;&amp;</span>
                <span class="plain">(!</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-chr.html#SP1">Characters::isdigit</a></span><span class="plain">(</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">pos</span><span class="plain">], </span><span class="constant">1</span><span class="plain">)))) </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="identifier">pos</span><span class="plain">++;</span>
        <span class="plain">}</span>
        <span class="identifier">ops_to</span><span class="plain"> = </span><span class="identifier">pos</span><span class="plain">-1;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">count</span><span class="plain"> = </span><span class="identifier">ops_to</span><span class="plain"> - </span><span class="identifier">ops_from</span><span class="plain"> + </span><span class="constant">1</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">arity</span><span class="plain"> &gt;= </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">count</span><span class="plain"> != </span><span class="identifier">arity</span><span class="plain">) {</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">arity</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">)</span>
                    <span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-em.html#SP2">Errors::fatal_with_text</a></span><span class="plain">(</span><span class="string">"this action takes no case name(s): %S"</span><span class="plain">, </span><span class="identifier">opt</span><span class="plain">);</span>
                <span class="reserved">else</span><span class="plain"> {</span>
                    <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">);</span>
                    <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">, </span><span class="string">"the action '%S' takes %d parameters"</span><span class="plain">, </span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">arity</span><span class="plain">);</span>
                    <span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-em.html#SP2">Errors::fatal_with_text</a></span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">M</span><span class="plain">);</span>
                    <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">);</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">count</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">)</span>
                <span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-em.html#SP2">Errors::fatal_with_text</a></span><span class="plain">(</span><span class="string">"this action must be followed by case name(s): %S"</span><span class="plain">, </span><span class="identifier">opt</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP1_2">&#167;1.2</a>.</p>

<p class="inwebparagraph"><a id="SP1_2_3"></a><b>&#167;1.2.3.  </b>After the operands, there can optionally be <code class="display"><span class="extract">-to F</span></code>, where <code class="display"><span class="extract">F</span></code> is a filename.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Parse an optional redirection filename</span> <span class="cwebmacronumber">1.2.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">pos</span><span class="plain">+1 &lt; </span><span class="identifier">to_arg_n</span><span class="plain">) &amp;&amp; (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">pos</span><span class="plain">], </span><span class="identifier">I</span><span class="string">"-to"</span><span class="plain">))) {</span>
            <span class="identifier">redirect_output</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-fln.html#SP3">Filenames::from_text</a></span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">pos</span><span class="plain">+1]);</span>
            <span class="identifier">pos</span><span class="plain"> += </span><span class="constant">2</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP1_2">&#167;1.2</a>.</p>

<p class="inwebparagraph"><a id="SP1_3"></a><b>&#167;1.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Translate the command into action item structures</span> <span class="cwebmacronumber">1.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">assoc_text</span><span class="plain">);</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">assoc_file1</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">, *</span><span class="identifier">assoc_file2</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">action</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">REPORT_ACTION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Create action item for REPORT</span> <span class="cwebmacronumber">1.3.1</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">COMBINE_REPORTS_ACTION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Create action item for COMBINE REPORTS</span> <span class="cwebmacronumber">1.3.2</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">FIND_ACTION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Create action item for FIND</span> <span class="cwebmacronumber">1.3.3</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SKEIN_ACTION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Create action item for SKEIN</span> <span class="cwebmacronumber">1.3.4</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="identifier">default:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Create more typical action items</span> <span class="cwebmacronumber">1.3.5</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">assoc_text</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_3_1"></a><b>&#167;1.3.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Create action item for REPORT</span> <span class="cwebmacronumber">1.3.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1], </span><span class="identifier">I</span><span class="string">"i7"</span><span class="plain">)) </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="constant">I7_FAILED_OUTCOME</span><span class="plain">;</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1], </span><span class="identifier">I</span><span class="string">"i6"</span><span class="plain">)) </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="constant">I6_FAILED_OUTCOME</span><span class="plain">;</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1], </span><span class="identifier">I</span><span class="string">"cursed"</span><span class="plain">)) </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="constant">CURSED_OUTCOME</span><span class="plain">;</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1], </span><span class="identifier">I</span><span class="string">"wrong"</span><span class="plain">)) </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="constant">WRONG_TRANSCRIPT_OUTCOME</span><span class="plain">;</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1], </span><span class="identifier">I</span><span class="string">"right"</span><span class="plain">)) </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="constant">PERFECT_OUTCOME</span><span class="plain">;</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-em.html#SP2">Errors::fatal_with_text</a></span><span class="plain">(</span>
            <span class="string">"expected 'i7', 'i6', 'wrong' or 'right' but found: %S"</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1]);</span>

        <span class="identifier">assoc_file1</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-fln.html#SP3">Filenames::from_text</a></span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+2]);</span>
        <span class="identifier">assoc_text</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+3];</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">assoc_text</span><span class="plain">, </span><span class="constant">0</span><span class="plain">) == </span><span class="character">'n'</span><span class="plain">) </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP24">Str::delete_first_character</a></span><span class="plain">(</span><span class="identifier">assoc_text</span><span class="plain">);</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">p</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+4];</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">p</span><span class="plain">, </span><span class="constant">0</span><span class="plain">) == </span><span class="character">'t'</span><span class="plain">) </span><span class="identifier">assoc_number2</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP7">Str::atoi</a></span><span class="plain">(</span><span class="identifier">p</span><span class="plain">, </span><span class="constant">1</span><span class="plain">);</span>
        <span class="functiontext"><a href="2-act.html#SP3">Actions::create</a></span><span class="plain">(</span><span class="identifier">action</span><span class="plain">, </span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">], </span><span class="identifier">args</span><span class="plain">,</span>
            <span class="identifier">assoc_number</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="identifier">assoc_text</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP1_3">&#167;1.3</a>.</p>

<p class="inwebparagraph"><a id="SP1_3_2"></a><b>&#167;1.3.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Create action item for COMBINE REPORTS</span> <span class="cwebmacronumber">1.3.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">assoc_file1</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-fln.html#SP3">Filenames::from_text</a></span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">]);</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">p</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1];</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">p</span><span class="plain">, </span><span class="constant">0</span><span class="plain">) == </span><span class="character">'-'</span><span class="plain">) </span><span class="identifier">assoc_number</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP7">Str::atoi</a></span><span class="plain">(</span><span class="identifier">p</span><span class="plain">, </span><span class="constant">1</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">assoc_number</span><span class="plain"> &lt;= </span><span class="constant">0</span><span class="plain">)</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-em.html#SP2">Errors::fatal_with_text</a></span><span class="plain">(</span>
                <span class="string">"expected dash then positive integer, e.g., '-5', but found: '%S'"</span><span class="plain">, </span><span class="identifier">p</span><span class="plain">);</span>
        <span class="functiontext"><a href="2-act.html#SP3">Actions::create</a></span><span class="plain">(</span><span class="identifier">action</span><span class="plain">, </span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">,</span>
            <span class="identifier">assoc_number</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="identifier">assoc_text</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP1_3">&#167;1.3</a>.</p>

<p class="inwebparagraph"><a id="SP1_3_3"></a><b>&#167;1.3.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Create action item for FIND</span> <span class="cwebmacronumber">1.3.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">assoc_text</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">];</span>
        <span class="functiontext"><a href="2-act.html#SP3">Actions::create</a></span><span class="plain">(</span><span class="identifier">action</span><span class="plain">, </span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">,</span>
            <span class="identifier">assoc_number</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="identifier">assoc_text</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP1_3">&#167;1.3</a>.</p>

<p class="inwebparagraph"><a id="SP1_3_4"></a><b>&#167;1.3.4.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Create action item for SKEIN</span> <span class="cwebmacronumber">1.3.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">assoc_file1</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-fln.html#SP3">Filenames::from_text</a></span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">]);</span>
        <span class="identifier">assoc_text</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">ops_from</span><span class="plain">+1];</span>
        <span class="functiontext"><a href="2-act.html#SP3">Actions::create</a></span><span class="plain">(</span><span class="identifier">action</span><span class="plain">, </span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">,</span>
            <span class="identifier">assoc_number</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="identifier">assoc_text</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP1_3">&#167;1.3</a>.</p>

<p class="inwebparagraph"><a id="SP1_3_5"></a><b>&#167;1.3.5.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Create more typical action items</span> <span class="cwebmacronumber">1.3.5</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ops_to</span><span class="plain"> &gt;= </span><span class="identifier">ops_from</span><span class="plain">)</span>
            <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">j</span><span class="plain"> = </span><span class="identifier">ops_from</span><span class="plain">; </span><span class="identifier">j</span><span class="plain"> &lt;= </span><span class="identifier">ops_to</span><span class="plain">; </span><span class="identifier">j</span><span class="plain">++)</span>
                <span class="functiontext"><a href="2-act.html#SP3">Actions::create</a></span><span class="plain">(</span><span class="identifier">action</span><span class="plain">, </span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">j</span><span class="plain">], </span><span class="identifier">args</span><span class="plain">,</span>
                    <span class="identifier">assoc_number</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="identifier">assoc_text</span><span class="plain">);</span>
        <span class="reserved">else</span>
            <span class="functiontext"><a href="2-act.html#SP3">Actions::create</a></span><span class="plain">(</span><span class="identifier">action</span><span class="plain">, </span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">,</span>
                <span class="identifier">assoc_number</span><span class="plain">, </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="identifier">assoc_text</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP1_3">&#167;1.3</a>.</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b>So, then, a command such as <code class="display"><span class="extract">-test alpha beta gamma</span></code> will cause three
instances of the "action item" structure to be created, of type <code class="display"><span class="extract">TEST_ACTION</span></code>
on <code class="display"><span class="extract">alpha</span></code>, <code class="display"><span class="extract">beta</span></code> and <code class="display"><span class="extract">gamma</span></code> respectively.
</p>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">action_item</span><span class="plain"> {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">action_type</span><span class="plain">; </span><span class="comment"> one of the <code class="display"><span class="extract">_ACTION</span></code> cases above</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">test_form</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">case_specifier</span><span class="plain"> </span><span class="identifier">operand</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">redirection_filename</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">assoc_number</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">assoc_number2</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">assoc_file1</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">assoc_file2</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">assoc_text</span><span class="plain">;</span>
        <span class="constant">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">action_item</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure action_item is accessed in 3/ts, 3/tr and here.</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>As each action item is created, it is added to the "to-do list" for this
run of Intest. (There is just one global to-do list.)
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Actions::create<button class="popup" onclick="togglePopup('usagePopup27')">...<span class="popuptext" id="usagePopup27">Usage of <b>Actions::create</b>:<br><a href="2-act.html#SP1_3_1">&#167;1.3.1</a>, <a href="2-act.html#SP1_3_2">&#167;1.3.2</a>, <a href="2-act.html#SP1_3_3">&#167;1.3.3</a>, <a href="2-act.html#SP1_3_4">&#167;1.3.4</a>, <a href="2-act.html#SP1_3_5">&#167;1.3.5</a></span></button></span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">action</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">redirect_output</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">op</span><span class="plain">, </span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">,</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">assoc_number</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">assoc_number2</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">assoc_file1</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">assoc_file2</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">) {</span>
        <span class="reserved">action_item</span><span class="plain"> *</span><span class="identifier">ai</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">action_item</span><span class="plain">);</span>
        <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain"> = </span><span class="identifier">action</span><span class="plain">;</span>
        <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">redirection_filename</span><span class="plain"> = </span><span class="identifier">redirect_output</span><span class="plain">;</span>
        <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">assoc_number</span><span class="plain"> = </span><span class="identifier">assoc_number</span><span class="plain">;</span>
        <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">assoc_number2</span><span class="plain"> = </span><span class="identifier">assoc_number2</span><span class="plain">;</span>
        <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">assoc_file1</span><span class="plain"> = </span><span class="identifier">assoc_file1</span><span class="plain">;</span>
        <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">assoc_file2</span><span class="plain"> = </span><span class="identifier">assoc_file2</span><span class="plain">;</span>
        <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">assoc_text</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">text</span><span class="plain">);</span>
        <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">operand</span><span class="plain"> = </span><span class="functiontext"><a href="2-act.html#SP5">Actions::parse_specifier</a></span><span class="plain">(</span><span class="identifier">op</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">);</span>

        <span class="identifier">ADD_TO_LINKED_LIST</span><span class="plain">(</span><span class="identifier">ai</span><span class="plain">, </span><span class="reserved">action_item</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-&gt;</span><span class="element">to_do_list</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4.  </b>A "case specifier" says what case(s) an action should apply to, and this
can involve a wildcard such as <code class="display"><span class="extract">all</span></code>:
</p>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">case_specifier</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">specific_case</span><span class="plain">; </span><span class="comment"> a specific test to apply to...</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">wild_card</span><span class="plain">; </span><span class="comment"> ...or a wildcard</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">regexp_wild_card</span><span class="plain">;</span>
    <span class="plain">} </span><span class="reserved">case_specifier</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure case_specifier is private to this section.</p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5.  </b></p>

<pre class="display">
    <span class="reserved">case_specifier</span><span class="plain"> </span><span class="functiontext">Actions::parse_specifier<button class="popup" onclick="togglePopup('usagePopup28')">...<span class="popuptext" id="usagePopup28">Usage of <b>Actions::parse_specifier</b>:<br><a href="2-act.html#SP3">&#167;3</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">token</span><span class="plain">, </span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">) {</span>
        <span class="reserved">case_specifier</span><span class="plain"> </span><span class="identifier">cs</span><span class="plain">;</span>
        <span class="identifier">cs</span><span class="plain">.</span><span class="element">wild_card</span><span class="plain"> = </span><span class="functiontext"><a href="2-act.html#SP6">Actions::identify_wildcard</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">);</span>
        <span class="identifier">cs</span><span class="plain">.</span><span class="element">specific_case</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">cs</span><span class="plain">.</span><span class="element">regexp_wild_card</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">token</span><span class="plain">) &amp;&amp; (</span><span class="identifier">cs</span><span class="plain">.</span><span class="element">wild_card</span><span class="plain"> == </span><span class="constant">TAMECARD</span><span class="plain">)) {</span>
            <span class="identifier">cs</span><span class="plain">.</span><span class="element">specific_case</span><span class="plain"> = </span><span class="functiontext"><a href="2-rf.html#SP3">RecipeFiles::find_case</a></span><span class="plain">(</span><span class="identifier">args</span><span class="plain">, </span><span class="identifier">token</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">cs</span><span class="plain">.</span><span class="element">specific_case</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">)</span>
                <span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-em.html#SP2">Errors::fatal_with_text</a></span><span class="plain">(</span><span class="string">"no such test case as %S"</span><span class="plain">, </span><span class="identifier">token</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">token</span><span class="plain">) &amp;&amp; (</span><span class="identifier">cs</span><span class="plain">.</span><span class="element">wild_card</span><span class="plain"> == </span><span class="constant">REGEXP_WILDCARD</span><span class="plain">))</span>
            <span class="identifier">cs</span><span class="plain">.</span><span class="element">regexp_wild_card</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">token</span><span class="plain">) &amp;&amp; (</span><span class="identifier">cs</span><span class="plain">.</span><span class="element">wild_card</span><span class="plain"> == </span><span class="constant">GROUP_WILDCARD</span><span class="plain">))</span>
            <span class="identifier">cs</span><span class="plain">.</span><span class="element">regexp_wild_card</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">cs</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6. Wildcards. </b></p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">COUNT_WILDCARD_BASE</span><span class="plain"> </span><span class="constant">1001</span><span class="plain"> </span><span class="comment"> 1001 is <code class="display"><span class="extract">^1</span></code>, 1002 is <code class="display"><span class="extract">^2</span></code>, ...</span>
    <span class="definitionkeyword">define</span> <span class="constant">EXTENSION_WILDCARD_BASE</span><span class="plain"> </span><span class="constant">101</span><span class="plain"> </span><span class="comment"> 101 is <code class="display"><span class="extract">A</span></code>, 102 is <code class="display"><span class="extract">B</span></code>, ...</span>
    <span class="definitionkeyword">define</span> <span class="constant">GROUP_WILDCARD</span><span class="plain"> </span><span class="constant">2</span>
    <span class="definitionkeyword">define</span> <span class="constant">REGEXP_WILDCARD</span><span class="plain"> </span><span class="constant">1</span>
    <span class="definitionkeyword">define</span> <span class="constant">TAMECARD</span><span class="plain"> </span><span class="constant">0</span>
    <span class="definitionkeyword">define</span> <span class="constant">ALL_WILDCARD</span><span class="plain"> -1</span>
    <span class="definitionkeyword">define</span> <span class="constant">EXAMPLES_WILDCARD</span><span class="plain"> -2</span>
    <span class="definitionkeyword">define</span> <span class="constant">CASES_WILDCARD</span><span class="plain"> -3</span>
    <span class="definitionkeyword">define</span> <span class="constant">PROBLEMS_WILDCARD</span><span class="plain"> -4</span>
    <span class="definitionkeyword">define</span> <span class="constant">EXTENSIONS_WILDCARD</span><span class="plain"> -5</span>
    <span class="definitionkeyword">define</span> <span class="constant">MAPS_WILDCARD</span><span class="plain"> -6</span>
</pre>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Actions::identify_wildcard<button class="popup" onclick="togglePopup('usagePopup29')">...<span class="popuptext" id="usagePopup29">Usage of <b>Actions::identify_wildcard</b>:<br><a href="2-act.html#SP5">&#167;5</a>, Recipe Files - <a href="2-rf.html#SP5">&#167;5</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">token</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">token</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">TAMECARD</span><span class="plain">;</span>
        <span class="identifier">LOOP_THROUGH_TEXT</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">, </span><span class="identifier">token</span><span class="plain">)</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get</a></span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">) == </span><span class="character">'%'</span><span class="plain">)</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="constant">REGEXP_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get_first_char</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">':'</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">GROUP_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">) == </span><span class="constant">1</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> &gt;= </span><span class="character">'A'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">c</span><span class="plain"> &lt;= </span><span class="character">'Z'</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> - </span><span class="character">'A'</span><span class="plain"> + </span><span class="constant">EXTENSION_WILDCARD_BASE</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> &gt;= </span><span class="character">'a'</span><span class="plain">) &amp;&amp; (</span><span class="identifier">c</span><span class="plain"> &lt;= </span><span class="character">'z'</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> - </span><span class="character">'a'</span><span class="plain"> + </span><span class="constant">EXTENSION_WILDCARD_BASE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"all"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">ALL_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"examples"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">EXAMPLES_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"cases"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">CASES_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"problems"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">PROBLEMS_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"maps"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">MAPS_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"extensions"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">EXTENSIONS_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get_first_char</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">) == </span><span class="character">'^'</span><span class="plain">) {</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">n</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP7">Str::atoi</a></span><span class="plain">(</span><span class="identifier">token</span><span class="plain">, </span><span class="constant">1</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">n</span><span class="plain"> &gt; </span><span class="constant">0</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">n</span><span class="plain"> - </span><span class="constant">1</span><span class="plain"> + </span><span class="constant">COUNT_WILDCARD_BASE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="constant">TAMECARD</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Actions::matches_wildcard<button class="popup" onclick="togglePopup('usagePopup30')">...<span class="popuptext" id="usagePopup30">Usage of <b>Actions::matches_wildcard</b>:<br><a href="2-act.html#SP7_1_5">&#167;7.1.5</a></span></button></span><span class="plain">(</span><span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">w</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">w</span><span class="plain"> == </span><span class="constant">ALL_WILDCARD</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">w</span><span class="plain"> == </span><span class="functiontext"><a href="2-act.html#SP6">Actions::which_wildcard</a></span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Actions::which_wildcard<button class="popup" onclick="togglePopup('usagePopup31')">...<span class="popuptext" id="usagePopup31">Usage of <b>Actions::which_wildcard</b>:<br>The Scheduler - <a href="3-ts.html#SP9_3_2">&#167;9.3.2</a></span></button></span><span class="plain">(</span><span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tc</span><span class="plain">-&gt;</span><span class="element">format_reference</span><span class="plain"> == </span><span class="constant">EXAMPLE_FORMAT</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">EXAMPLES_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tc</span><span class="plain">-&gt;</span><span class="element">test_type</span><span class="plain"> == </span><span class="constant">PROBLEM_SPT</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">PROBLEMS_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tc</span><span class="plain">-&gt;</span><span class="element">test_type</span><span class="plain"> == </span><span class="constant">MAP_SPT</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">MAPS_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tc</span><span class="plain">-&gt;</span><span class="element">format_reference</span><span class="plain"> == </span><span class="constant">EXTENSION_FORMAT</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">EXTENSIONS_WILDCARD</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="constant">CASES_WILDCARD</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">char</span><span class="plain"> *</span><span class="functiontext">Actions::name_of_wildcard<button class="popup" onclick="togglePopup('usagePopup32')">...<span class="popuptext" id="usagePopup32">Usage of <b>Actions::name_of_wildcard</b>:<br>The Scheduler - <a href="3-ts.html#SP9_3_2">&#167;9.3.2</a></span></button></span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">w</span><span class="plain">) {</span>
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">w</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">EXAMPLES_WILDCARD:</span><span class="plain"> </span><span class="reserved">return</span><span class="plain"> </span><span class="string">"examples"</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">EXTENSIONS_WILDCARD:</span><span class="plain"> </span><span class="reserved">return</span><span class="plain"> </span><span class="string">"extensions"</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">PROBLEMS_WILDCARD:</span><span class="plain"> </span><span class="reserved">return</span><span class="plain"> </span><span class="string">"problems"</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">MAPS_WILDCARD:</span><span class="plain"> </span><span class="reserved">return</span><span class="plain"> </span><span class="string">"maps"</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">CASES_WILDCARD:</span><span class="plain"> </span><span class="reserved">return</span><span class="plain"> </span><span class="string">"cases"</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="string">"?"</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP7"></a><b>&#167;7. Performance. </b>At this point, parsing is long over. We have to perform the actions in the
to-do list:
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Actions::perform<button class="popup" onclick="togglePopup('usagePopup33')">...<span class="popuptext" id="usagePopup33">Usage of <b>Actions::perform</b>:<br>Main - <a href="1-mn.html#SP1_4">&#167;1.4</a></span></button></span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">) {</span>
        <span class="functiontext"><a href="3-th.html#SP4">Hasher::read_hashes</a></span><span class="plain">(</span><span class="identifier">args</span><span class="plain">);</span>
        <span class="functiontext"><a href="3-ts.html#SP1">Scheduler::start</a></span><span class="plain">(</span><span class="identifier">args</span><span class="plain">-&gt;</span><span class="element">threads_available</span><span class="plain">);</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">count</span><span class="plain"> = </span><span class="constant">1</span><span class="plain">;</span>
        <span class="reserved">action_item</span><span class="plain"> *</span><span class="identifier">ai</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">ai</span><span class="plain">, </span><span class="reserved">action_item</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-&gt;</span><span class="element">to_do_list</span><span class="plain">)</span>
            &lt;<span class="cwebmacro">Perform this action item</span> <span class="cwebmacronumber">7.1</span>&gt;<span class="plain">;</span>

        <span class="functiontext"><a href="3-ts.html#SP9">Scheduler::test</a></span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
        <span class="functiontext"><a href="3-th.html#SP5">Hasher::write_hashes</a></span><span class="plain">();</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP7_1"></a><b>&#167;7.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perform this action item</span> <span class="cwebmacronumber">7.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">operand</span><span class="plain">.</span><span class="element">wild_card</span><span class="plain"> &gt;= </span><span class="constant">COUNT_WILDCARD_BASE</span><span class="plain">) </span>&lt;<span class="cwebmacro">Perform this counted case</span> <span class="cwebmacronumber">7.1.1</span>&gt;
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">operand</span><span class="plain">.</span><span class="element">wild_card</span><span class="plain"> &gt;= </span><span class="constant">EXTENSION_WILDCARD_BASE</span><span class="plain">) </span>&lt;<span class="cwebmacro">Perform this lettered case</span> <span class="cwebmacronumber">7.1.2</span>&gt;
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">operand</span><span class="plain">.</span><span class="element">wild_card</span><span class="plain"> == </span><span class="constant">TAMECARD</span><span class="plain">)</span>
            <span class="functiontext"><a href="2-act.html#SP9">Actions::perform_inner</a></span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">operand</span><span class="plain">.</span><span class="element">specific_case</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">++);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">operand</span><span class="plain">.</span><span class="element">wild_card</span><span class="plain"> == </span><span class="constant">REGEXP_WILDCARD</span><span class="plain">) </span>&lt;<span class="cwebmacro">Perform this regular expressed case</span> <span class="cwebmacronumber">7.1.3</span>&gt;
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">operand</span><span class="plain">.</span><span class="element">wild_card</span><span class="plain"> == </span><span class="constant">GROUP_WILDCARD</span><span class="plain">) </span>&lt;<span class="cwebmacro">Perform this grouped case</span> <span class="cwebmacronumber">7.1.4</span>&gt;
        <span class="reserved">else</span><span class="plain"> </span>&lt;<span class="cwebmacro">Perform this matched case</span> <span class="cwebmacronumber">7.1.5</span>&gt;<span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP7">&#167;7</a>.</p>

<p class="inwebparagraph"><a id="SP7_1_1"></a><b>&#167;7.1.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perform this counted case</span> <span class="cwebmacronumber">7.1.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">find_count</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
        <span class="reserved">search_path_item</span><span class="plain"> *</span><span class="identifier">spi</span><span class="plain">;</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">spi</span><span class="plain">, </span><span class="reserved">search_path_item</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-&gt;</span><span class="element">search_path</span><span class="plain">)</span>
            <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">spi</span><span class="plain">-&gt;</span><span class="element">contents</span><span class="plain">)</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">find_count</span><span class="plain">++ == </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">operand</span><span class="plain">.</span><span class="element">wild_card</span><span class="plain"> - </span><span class="constant">COUNT_WILDCARD_BASE</span><span class="plain">) {</span>
                    <span class="functiontext"><a href="2-act.html#SP9">Actions::perform_inner</a></span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">++);</span>
                    <span class="reserved">goto</span><span class="plain"> </span><span class="identifier">ExitCountSearch</span><span class="plain">;</span>
                <span class="plain">}</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">find_count</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">)</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">, </span><span class="string">"there were no cases here at all"</span><span class="plain">);</span>
        <span class="reserved">else</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">, </span><span class="string">"cases only run from ^1 to ^%d"</span><span class="plain">, </span><span class="identifier">find_count</span><span class="plain">);</span>
        <span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-em.html#SP2">Errors::fatal_with_text</a></span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">M</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">M</span><span class="plain">);</span>
        <span class="identifier">ExitCountSearch:</span><span class="plain"> ;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP7_1">&#167;7.1</a>.</p>

<p class="inwebparagraph"><a id="SP7_1_2"></a><b>&#167;7.1.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perform this lettered case</span> <span class="cwebmacronumber">7.1.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">search_path_item</span><span class="plain"> *</span><span class="identifier">spi</span><span class="plain">;</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">spi</span><span class="plain">, </span><span class="reserved">search_path_item</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-&gt;</span><span class="element">search_path</span><span class="plain">)</span>
            <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">spi</span><span class="plain">-&gt;</span><span class="element">contents</span><span class="plain">)</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">tc</span><span class="plain">-&gt;</span><span class="element">format_reference</span><span class="plain"> == </span><span class="constant">EXTENSION_FORMAT</span><span class="plain">) &amp;&amp;</span>
                    <span class="plain">(</span><span class="identifier">tc</span><span class="plain">-&gt;</span><span class="element">letter_reference</span><span class="plain"> ==</span>
                        <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">operand</span><span class="plain">.</span><span class="element">wild_card</span><span class="plain"> - </span><span class="constant">EXTENSION_WILDCARD_BASE</span><span class="plain"> + </span><span class="constant">1</span><span class="plain">)) {</span>
                    <span class="functiontext"><a href="2-act.html#SP9">Actions::perform_inner</a></span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">++);</span>
                    <span class="reserved">goto</span><span class="plain"> </span><span class="identifier">ExitLetterSearch</span><span class="plain">;</span>
                <span class="plain">}</span>
        <span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-em.html#SP2">Errors::fatal</a></span><span class="plain">(</span><span class="string">"unable to find any such extension example"</span><span class="plain">);</span>
        <span class="identifier">ExitLetterSearch:</span><span class="plain"> ;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP7_1">&#167;7.1</a>.</p>

<p class="inwebparagraph"><a id="SP7_1_3"></a><b>&#167;7.1.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perform this regular expressed case</span> <span class="cwebmacronumber">7.1.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">matches</span><span class="plain"> = </span><span class="identifier">NEW_LINKED_LIST</span><span class="plain">(</span><span class="reserved">test_case</span><span class="plain">);</span>
        <span class="functiontext"><a href="2-rf.html#SP11">RecipeFiles::find_cases_matching</a></span><span class="plain">(</span><span class="identifier">matches</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-&gt;</span><span class="element">search_path</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">operand</span><span class="plain">.</span><span class="element">regexp_wild_card</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">);</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">matches</span><span class="plain">) {</span>
            <span class="functiontext"><a href="2-act.html#SP9">Actions::perform_inner</a></span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">++);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP7_1">&#167;7.1</a>.</p>

<p class="inwebparagraph"><a id="SP7_1_4"></a><b>&#167;7.1.4.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perform this grouped case</span> <span class="cwebmacronumber">7.1.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">scheduled</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">leafname</span><span class="plain">);</span>
        <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">leafname</span><span class="plain">, </span><span class="string">"%S.testgroup"</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">operand</span><span class="plain">.</span><span class="element">regexp_wild_card</span><span class="plain">);</span>
        <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP24">Str::delete_first_character</a></span><span class="plain">(</span><span class="identifier">leafname</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get_first_char</a></span><span class="plain">(</span><span class="identifier">leafname</span><span class="plain">) == </span><span class="character">':'</span><span class="plain">) {</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP24">Str::delete_first_character</a></span><span class="plain">(</span><span class="identifier">leafname</span><span class="plain">);</span>
            <span class="identifier">scheduled</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-fln.html#SP2">Filenames::in</a></span><span class="plain">(</span><span class="identifier">args</span><span class="plain">-&gt;</span><span class="element">groups_folder</span><span class="plain">, </span><span class="identifier">leafname</span><span class="plain">);</span>
        <span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">names_in_group</span><span class="plain"> = </span><span class="identifier">NEW_LINKED_LIST</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain">);</span>
        <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-tf.html#SP5">TextFiles::read</a></span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="string">"can't open test group file"</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">,</span>
            <span class="plain">&amp;</span><span class="functiontext"><a href="2-act.html#SP8">Actions::read_group</a></span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">names_in_group</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">leafname</span><span class="plain">);</span>

        <span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">matches</span><span class="plain"> = </span><span class="identifier">NEW_LINKED_LIST</span><span class="plain">(</span><span class="reserved">test_case</span><span class="plain">);</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">names_in_group</span><span class="plain">) {</span>
            <span class="functiontext"><a href="2-rf.html#SP11">RecipeFiles::find_cases_matching</a></span><span class="plain">(</span><span class="identifier">matches</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-&gt;</span><span class="element">search_path</span><span class="plain">, </span><span class="identifier">name</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">matches</span><span class="plain">) {</span>
            <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">test_form</span><span class="plain"> = </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">scheduled</span><span class="plain">) </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain"> += </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">;</span>
            <span class="functiontext"><a href="2-act.html#SP9">Actions::perform_inner</a></span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">++);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">scheduled</span><span class="plain">) </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain"> -= </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP7_1">&#167;7.1</a>.</p>

<p class="inwebparagraph"><a id="SP7_1_5"></a><b>&#167;7.1.5.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Perform this matched case</span> <span class="cwebmacronumber">7.1.5</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">search_path_item</span><span class="plain"> *</span><span class="identifier">spi</span><span class="plain">;</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">spi</span><span class="plain">, </span><span class="reserved">search_path_item</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-&gt;</span><span class="element">search_path</span><span class="plain">)</span>
            <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">spi</span><span class="plain">-&gt;</span><span class="element">contents</span><span class="plain">)</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="2-act.html#SP6">Actions::matches_wildcard</a></span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">operand</span><span class="plain">.</span><span class="element">wild_card</span><span class="plain">)) {</span>
                    <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">test_form</span><span class="plain"> = </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain">;</span>
                    <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain"> += </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">;</span>
                    <span class="functiontext"><a href="2-act.html#SP9">Actions::perform_inner</a></span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">++);</span>
                    <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain"> -= </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">;</span>
                <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP7_1">&#167;7.1</a>.</p>

<p class="inwebparagraph"><a id="SP8"></a><b>&#167;8.  </b></p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Actions::read_group<button class="popup" onclick="togglePopup('usagePopup34')">...<span class="popuptext" id="usagePopup34">Usage of <b>Actions::read_group</b>:<br><a href="2-act.html#SP7_1_4">&#167;7.1.4</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">vm</span><span class="plain">) {</span>
        <span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">matches</span><span class="plain"> = (</span><span class="reserved">linked_list</span><span class="plain"> *) </span><span class="identifier">vm</span><span class="plain">;</span>
        <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP23">Str::trim_white_space</a></span><span class="plain">(</span><span class="identifier">text</span><span class="plain">);</span>
        <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get_first_char</a></span><span class="plain">(</span><span class="identifier">text</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) || (</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">'#'</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain">;</span>
        <span class="identifier">ADD_TO_LINKED_LIST</span><span class="plain">(</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">text</span><span class="plain">), </span><span class="reserved">text_stream</span><span class="plain">, </span><span class="identifier">matches</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP9"></a><b>&#167;9.  </b>And now we can forget everything about wild cards: we know for definite
which test case to work on.
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Actions::perform_inner<button class="popup" onclick="togglePopup('usagePopup35')">...<span class="popuptext" id="usagePopup35">Usage of <b>Actions::perform_inner</b>:<br><a href="2-act.html#SP7_1">&#167;7.1</a>, <a href="2-act.html#SP7_1_1">&#167;7.1.1</a>, <a href="2-act.html#SP7_1_2">&#167;7.1.2</a>, <a href="2-act.html#SP7_1_3">&#167;7.1.3</a>, <a href="2-act.html#SP7_1_4">&#167;7.1.4</a>, <a href="2-act.html#SP7_1_5">&#167;7.1.5</a></span></button></span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">,</span>
        <span class="reserved">action_item</span><span class="plain"> *</span><span class="identifier">ai</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">itc</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">count</span><span class="plain">) {</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">TO</span><span class="plain"> = </span><span class="identifier">OUT</span><span class="plain">;</span>
        <span class="reserved">text_stream</span><span class="plain"> </span><span class="identifier">TO_struct</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain"> &lt; </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">) &amp;&amp; (</span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">redirection_filename</span><span class="plain">)) {</span>
            <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">redirection_filename</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">itc</span><span class="plain">) </span>&lt;<span class="cwebmacro">Expand NAME and NUMBER in the redirection filename</span> <span class="cwebmacronumber">9.1</span>&gt;<span class="plain">;</span>
            <span class="identifier">TO</span><span class="plain"> = &amp;</span><span class="identifier">TO_struct</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">STREAM_OPEN_TO_FILE</span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">, </span><span class="constant">UTF8_ENC</span><span class="plain">) == </span><span class="constant">FALSE</span><span class="plain">)</span>
                <span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-em.html#SP2">Errors::fatal_with_file</a></span><span class="plain">(</span><span class="string">"unable to write file"</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">);</span>
        <span class="plain">}</span>
        &lt;<span class="cwebmacro">Finally do something, or at leask ask somebody else to</span> <span class="cwebmacronumber">9.2</span>&gt;<span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain"> &lt; </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">) &amp;&amp; (</span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">redirection_filename</span><span class="plain">)) </span><span class="identifier">STREAM_CLOSE</span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP9_1"></a><b>&#167;9.1.  </b>If the leafname of the redirection file is <code class="display"><span class="extract">something_[NUMBER]</span></code> then we
substitute in the case number for <code class="display"><span class="extract">[NUMBER]</span></code>, and similarly for <code class="display"><span class="extract">[NAME]</span></code>.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Expand NAME and NUMBER in the redirection filename</span> <span class="cwebmacronumber">9.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">);</span>
        <span class="identifier">leaf</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-fln.html#SP7">Filenames::get_leafname</a></span><span class="plain">(</span><span class="identifier">F</span><span class="plain">));</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">while</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">leaf</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*?)%[NAME%](%c*)"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP15">Str::clear</a></span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">);</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">, </span><span class="string">"%S%s%S"</span><span class="plain">, </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">itc</span><span class="plain">-&gt;</span><span class="element">test_case_name</span><span class="plain">, </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1]);</span>
        <span class="plain">}</span>
        <span class="reserved">while</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">leaf</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*?)%[NUMBER%](%c*)"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP15">Str::clear</a></span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">);</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">, </span><span class="string">"%S%d%S"</span><span class="plain">, </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">count</span><span class="plain">, </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1]);</span>
        <span class="plain">}</span>
        <span class="identifier">F</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-fln.html#SP2">Filenames::in</a></span><span class="plain">(</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-fln.html#SP6">Filenames::up</a></span><span class="plain">(</span><span class="identifier">F</span><span class="plain">), </span><span class="identifier">leaf</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">);</span>
        <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP9">&#167;9</a>.</p>

<p class="inwebparagraph"><a id="SP9_2"></a><b>&#167;9.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Finally do something, or at leask ask somebody else to</span> <span class="cwebmacronumber">9.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">CATALOGUE_ACTION:</span>
                <span class="functiontext"><a href="2-rf.html#SP10">RecipeFiles::perform_catalogue</a></span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-&gt;</span><span class="element">search_path</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">FIND_ACTION:</span>
                <span class="functiontext"><a href="2-rf.html#SP10">RecipeFiles::perform_catalogue</a></span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-&gt;</span><span class="element">search_path</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">assoc_text</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SOURCE_ACTION:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">CONCORDANCE_ACTION:</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">itc</span><span class="plain">)</span>
                    <span class="functiontext"><a href="2-te.html#SP2">Extractor::run</a></span><span class="plain">(</span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">-&gt;</span><span class="element">test_location</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">-&gt;</span><span class="element">format_reference</span><span class="plain">,</span>
                        <span class="identifier">itc</span><span class="plain">-&gt;</span><span class="element">letter_reference</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
                <span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SCRIPT_ACTION:</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">itc</span><span class="plain">) {</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-tf.html#SP1">TextFiles::exists</a></span><span class="plain">(</span><span class="identifier">itc</span><span class="plain">-&gt;</span><span class="element">commands_location</span><span class="plain">))</span>
                        <span class="functiontext"><a href="2-te.html#SP2">Extractor::run</a></span><span class="plain">(</span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">-&gt;</span><span class="element">commands_location</span><span class="plain">, </span><span class="constant">PLAIN_FORMAT</span><span class="plain">,</span>
                            <span class="constant">0</span><span class="plain">, </span><span class="constant">SOURCE_ACTION</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
                    <span class="reserved">else</span>
                        <span class="functiontext"><a href="2-te.html#SP2">Extractor::run</a></span><span class="plain">(</span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">-&gt;</span><span class="element">test_location</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">-&gt;</span><span class="element">format_reference</span><span class="plain">,</span>
                            <span class="identifier">itc</span><span class="plain">-&gt;</span><span class="element">letter_reference</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
                <span class="plain">}</span>
                <span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">OPEN_ACTION:</span>
                <span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-shl.html#SP2">Shell::apply</a></span><span class="plain">(</span><span class="string">"open"</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">-&gt;</span><span class="element">test_location</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">BBDIFF_ACTION:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">DIFF_ACTION:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">TEST_ACTION:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">DEBUGGER_ACTION:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">BLESS_ACTION:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">CURSE_ACTION:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SHOW_ACTION:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SHOW_I6_ACTION:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SHOW_TRANSCRIPT_ACTION:</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">REBLESS_ACTION:</span>
                <span class="functiontext"><a href="4-tt.html#SP1">Tester::test</a></span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">, -1, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">REPORT_ACTION:</span>
                <span class="functiontext"><a href="3-tr.html#SP2">Reporter::report_single</a></span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">itc</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">COMBINE_REPORTS_ACTION:</span>
                <span class="functiontext"><a href="3-tr.html#SP4">Reporter::combine</a></span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">assoc_number</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">assoc_file1</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SKEIN_ACTION:</span>
                <span class="functiontext"><a href="3-skn.html#SP11">Skeins::test_i7_skein</a></span><span class="plain">(</span><span class="identifier">TO</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">assoc_file1</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">assoc_text</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="identifier">default:</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain"> &gt;= </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">) {</span>
                    <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain"> -= </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">;</span>
                    <span class="functiontext"><a href="3-ts.html#SP8">Scheduler::schedule</a></span><span class="plain">(</span><span class="identifier">itc</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">redirection_filename</span><span class="plain">, </span><span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">test_form</span><span class="plain">);</span>
                    <span class="identifier">ai</span><span class="plain">-&gt;</span><span class="element">action_type</span><span class="plain"> += </span><span class="constant">SCHEDULED_TEST_ACTION</span><span class="plain">;</span>
                    <span class="reserved">break</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"unimplemented action"</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="2-act.html#SP9">&#167;9</a>.</p>

<hr class="tocbar">
<ul class="toc"><li><a href="2-gv.html">Back to 'Global Variables'</a></li><li><a href="2-th.html">Continue with 'The Historian'</a></li></ul><hr class="tocbar">
<!--End of weave-->
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
		</main>
	</body>
</html>

