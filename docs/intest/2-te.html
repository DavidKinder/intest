<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>2/th</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
	</head>
	<body>

<!--Weave of '2/te' generated by 7-->
<ul class="crumbs"><li><a href="../webs.html">&#9733;</a></li><li><a href="index.html">intest 2.0</a></li><li><a href="index.html#2">Chapter 2: Test Cases and Instructions</a></li><li><b>The Extractor</b></li></ul><p class="purpose">To extract the text of a test case from its file on disc.</p>

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1.  </b>Recall that each test case lives somewhere in a file, whose format is one
of <code class="display"><span class="extract">PLAIN_FORMAT</span></code>, <code class="display"><span class="extract">EXAMPLE_FORMAT</span></code> or <code class="display"><span class="extract">EXTENSION_FORMAT</span></code>, though the latter two
only ever arise when testing Inform 7.
</p>

<p class="inwebparagraph">Our main task in this section if to extract that test case, which is a
trivial operation for <code class="display"><span class="extract">PLAIN_FORMAT</span></code> &mdash; the entire file is the test case &mdash;
but non-trivial for the other two, and requires some exhausting parsing.
</p>


<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">extraction_state</span><span class="plain"> {</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">DEST</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">case_list</span><span class="plain">; </span>    <span class="comment">of <code class="display"><span class="extract">test_case</span></code></span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">documentation_found</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">file_format</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">seek_ref</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">examples_found</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">about_to_extract</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">now_extracting</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">continue_script</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">extraction_line_count</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">extractor_command</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">concordance_offset</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">to_use_recipe</span><span class="plain">;</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">force_vm</span><span class="plain">;</span>
    <span class="plain">} </span><span class="reserved">extraction_state</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure extraction_state is private to this section.</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b>The Extractor can be called with four commands, all (not coincidentally)
action commands: <code class="display"><span class="extract">SOURCE_ACTION</span></code>, <code class="display"><span class="extract">SCRIPT_ACTION</span></code>, <code class="display"><span class="extract">CONCORDANCE_ACTION</span></code> and
<code class="display"><span class="extract">CENSUS_ACTION</span></code>. The first three indeed implement <code class="display"><span class="extract">-source</span></code>, <code class="display"><span class="extract">-script</span></code> and
<code class="display"><span class="extract">-concordance</span></code>, but the Extractor is used for other purposes too. In
<code class="display"><span class="extract">CENSUS_ACTION</span></code>, it is used simply to identify the test cases in a file.
The Extractor can also be called from Delia code. So it's a more
general-purpose function than it looks.
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extractor::run</span><span class="plain">(</span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">, </span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">format</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">ref</span><span class="plain">,</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">cmd</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">recipe_name</span><span class="plain">) {</span>
        <span class="reserved">extraction_state</span><span class="plain"> </span><span class="identifier">es</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.tc</span><span class="plain"> = </span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.case_list</span><span class="plain"> = </span><span class="identifier">L</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.DEST</span><span class="plain"> = </span><span class="identifier">OUT</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.file_format</span><span class="plain"> = </span><span class="identifier">format</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.seek_ref</span><span class="plain"> = </span><span class="identifier">ref</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.documentation_found</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.examples_found</span><span class="plain"> = 0;</span>
        <span class="identifier">es</span><span class="element">.about_to_extract</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.now_extracting</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.continue_script</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.extraction_line_count</span><span class="plain"> = 0;</span>
        <span class="identifier">es</span><span class="element">.extractor_command</span><span class="plain"> = </span><span class="identifier">cmd</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.concordance_offset</span><span class="plain"> = 0;</span>
        <span class="identifier">es</span><span class="element">.force_vm</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.to_use_recipe</span><span class="plain"> = </span><span class="identifier">recipe_name</span><span class="plain">;</span>
        <span class="functiontext">TextFiles::read</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="string">"can't open test case file"</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">, &amp;</span><span class="functiontext">Extractor::fan</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, &amp;</span><span class="identifier">es</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extractor::fan</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">line</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">ves</span><span class="plain">) {</span>
        <span class="reserved">extraction_state</span><span class="plain"> *</span><span class="identifier">es</span><span class="plain"> = </span><span class="identifier">ves</span><span class="plain">;</span>

        &lt;<span class="cwebmacro">Consider entering extraction mode</span> <span class="cwebmacronumber">2.1</span>&gt;<span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;now_extracting</span><span class="plain">) {</span>
            &lt;<span class="cwebmacro">Extract the line</span> <span class="cwebmacronumber">2.3</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Consider leaving extraction mode</span> <span class="cwebmacronumber">2.2</span>&gt;<span class="plain">;</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Extractor::run is used in <a href="#SP4">&#167;4</a>, 2/rf (<a href="2-rf.html#SP6_2">&#167;6.2</a>, <a href="2-rf.html#SP6_3">&#167;6.3</a>, <a href="2-rf.html#SP10">&#167;10</a>), 2/act (<a href="2-act.html#SP8_2">&#167;8.2</a>), 4/tt (<a href="4-tt.html#SP2">&#167;2</a>).</p>

<p class="endnote">The function Extractor::fan appears nowhere else.</p>

<p class="inwebparagraph"><a id="SP2_1"></a><b>&#167;2.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Consider entering extraction mode</span> <span class="cwebmacronumber">2.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;file_format</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">PLAIN_FORMAT</span><span class="plain">: </span>&lt;<span class="cwebmacro">Consider entering extraction mode for PLAIN</span> <span class="cwebmacronumber">2.1.1</span>&gt;<span class="plain">;</span>
                <span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">EXAMPLE_FORMAT</span><span class="plain">: </span>&lt;<span class="cwebmacro">Consider entering extraction mode for EXAMPLE</span> <span class="cwebmacronumber">2.1.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">EXTENSION_FORMAT</span><span class="plain">: </span>&lt;<span class="cwebmacro">Consider entering extraction mode for EXTENSION</span> <span class="cwebmacronumber">2.1.3</span>&gt;<span class="plain">;</span>
                <span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2">&#167;2</a>.</p>

<p class="inwebparagraph"><a id="SP2_1_1"></a><b>&#167;2.1.1.  </b>If the file is plain text, always go into extraction mode from line 1
onwards, so that we capture the entire file. If the opening line is a
double-quoted text, then that's the title for the test case.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Consider entering extraction mode for PLAIN</span> <span class="cwebmacronumber">2.1.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tfp</span><span class="plain">-</span><span class="element">&gt;line_count</span><span class="plain"> == 1) {</span>
            <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"\</span><span class="plain">"</span><span class="string">(%c*?)\</span><span class="plain">"</span><span class="string"> *"</span><span class="plain">)) &amp;&amp; (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;tc</span><span class="plain">)) {</span>
                <span class="functiontext">RecipeFiles::NameTestCase</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;tc</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
                <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;now_extracting</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2_1">&#167;2.1</a>.</p>

<p class="inwebparagraph"><a id="SP2_1_2"></a><b>&#167;2.1.2.  </b>See the Inform 7 documentation examples to explain this more fully, but
this is a typical start of an EXAMPLE file:
</p>

<p class="inwebparagraph"></p>


<pre class="display">
        <span class="plain">* Printing the banner text</span>
        <span class="plain">(Banner printing at appropriate times; Bikini Atoll)</span>
        <span class="plain">Delaying the banner for later.</span>
        
        <span class="plain">    {*}"Bikini Atoll" by Edward Teller</span>
        
        <span class="plain">    The Hut and the Tropical Beach are rooms.</span>
</pre>

<p class="inwebparagraph">The test case can only begin after the header, which always occupies three
lines, and we look out for the <code class="display"><span class="extract">{*}</span></code> marker.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Consider entering extraction mode for EXAMPLE</span> <span class="cwebmacronumber">2.1.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">line_content</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">tfp</span><span class="plain">-</span><span class="element">&gt;line_count</span><span class="plain"> &gt; 3) &amp;&amp; (</span><span class="functiontext">Str::begins_with_wide_string</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"\</span><span class="plain">t</span><span class="string">{*}"</span><span class="plain">))) {</span>
            <span class="functiontext">Str::copy_tail</span><span class="plain">(</span><span class="identifier">line_content</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, 4);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;examples_found</span><span class="plain">++ == 0) {</span>
                <span class="functiontext">Str::clear</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">);</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="string">"\</span><span class="plain">t</span><span class="string">%S"</span><span class="plain">, </span><span class="identifier">line_content</span><span class="plain">);</span>
                <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"%t\</span><span class="plain">"</span><span class="string">(%c*?)\</span><span class="plain">"</span><span class="string"> *"</span><span class="plain">)) {</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;extractor_command</span><span class="plain"> == </span><span class="constant">CENSUS_ACTION</span><span class="plain">)</span>
                        <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;tc</span><span class="plain"> = </span><span class="functiontext">RecipeFiles::observe_in_example</span><span class="plain">(</span>
                            <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;case_list</span><span class="plain">, </span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;force_vm</span><span class="plain">, </span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;to_use_recipe</span><span class="plain">);</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;tc</span><span class="plain">) </span><span class="functiontext">RecipeFiles::NameTestCase</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;tc</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
                <span class="plain">}</span>
                <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
                <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;now_extracting</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
                <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;now_extracting</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;extraction_line_count</span><span class="plain"> &gt; 0) &amp;&amp;</span>
            <span class="plain">(</span><span class="functiontext">Str::begins_with_wide_string</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"\</span><span class="plain">t</span><span class="string">{**}"</span><span class="plain">))) {</span>
            <span class="functiontext">Str::copy_tail</span><span class="plain">(</span><span class="identifier">line_content</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, 5);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;examples_found</span><span class="plain"> == 1) {</span>
                <span class="functiontext">Str::clear</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">);</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="string">"\</span><span class="plain">t</span><span class="string">%S"</span><span class="plain">, </span><span class="identifier">line_content</span><span class="plain">);</span>
                <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;now_extracting</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">line_content</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2_1">&#167;2.1</a>.</p>

<p class="inwebparagraph"><a id="SP2_1_3"></a><b>&#167;2.1.3.  </b>Examples are found after the <code class="display"><span class="extract">---- Documentation ----</span></code> divider in an
extension file. There can be more than one.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Consider entering extraction mode for EXTENSION</span> <span class="cwebmacronumber">2.1.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">tfp</span><span class="plain">-</span><span class="element">&gt;line_count</span><span class="plain"> == 1) &amp;&amp; (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"%c*for Glulx only%c*"</span><span class="plain">)))</span>
            <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;force_vm</span><span class="plain"> = </span><span class="functiontext">Str::new_from_ISO_string</span><span class="plain">(</span><span class="string">"G"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *---- +DOCUMENTATION +---- *"</span><span class="plain">))</span>
            <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;documentation_found</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *---- +Documentation +---- *"</span><span class="plain">))</span>
            <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;documentation_found</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *---- +documentation +---- *"</span><span class="plain">))</span>
            <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;documentation_found</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;documentation_found</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *Example: %*+ %c*"</span><span class="plain">)) {</span>
                <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;now_extracting</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
                <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;examples_found</span><span class="plain">++;</span>
                <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;about_to_extract</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;extractor_command</span><span class="plain"> == </span><span class="constant">CENSUS_ACTION</span><span class="plain">)</span>
                    <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;tc</span><span class="plain"> = </span><span class="functiontext">RecipeFiles::observe_in_extension</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;case_list</span><span class="plain">,</span>
                        <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;examples_found</span><span class="plain">, </span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;force_vm</span><span class="plain">, </span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;to_use_recipe</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;about_to_extract</span><span class="plain">) &amp;&amp; (</span><span class="functiontext">Str::begins_with_wide_string</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"\</span><span class="plain">t</span><span class="string">*:"</span><span class="plain">))) {</span>
                <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;about_to_extract</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
                <span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain"> = 3;</span>
                <span class="reserved">while</span><span class="plain"> (</span><span class="functiontext">Regexp::white_space</span><span class="plain">(</span><span class="functiontext">Str::get_at</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">))) </span><span class="identifier">i</span><span class="plain">++;</span>
                <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">ext_eg</span><span class="plain">);</span>
                <span class="functiontext">Str::copy_tail</span><span class="plain">(</span><span class="identifier">ext_eg</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;extractor_command</span><span class="plain"> == </span><span class="constant">CENSUS_ACTION</span><span class="plain">) ||</span>
                    <span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;examples_found</span><span class="plain"> == </span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;seek_ref</span><span class="plain">)) {</span>
                    <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">ext_eg</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"\</span><span class="plain">"</span><span class="string">(%c*?)\</span><span class="plain">"</span><span class="string"> *"</span><span class="plain">)) &amp;&amp; (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;tc</span><span class="plain">))</span>
                        <span class="functiontext">RecipeFiles::NameTestCase</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;tc</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
                    <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;now_extracting</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                    <span class="functiontext">Extractor::line_out</span><span class="plain">(</span><span class="identifier">ext_eg</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">, </span><span class="identifier">es</span><span class="plain">);</span>
                    <span class="reserved">return</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">ext_eg</span><span class="plain">);</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2_1">&#167;2.1</a>.</p>

<p class="inwebparagraph"><a id="SP2_2"></a><b>&#167;2.2.  </b>For a PLAIN file, we never leave extraction mode: we extract the whole thing.
For an EXAMPLE or EXTENSION, we stop as soon as we find a non-white-space
character in column 1.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Consider leaving extraction mode</span> <span class="cwebmacronumber">2.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;file_format</span><span class="plain"> != </span><span class="constant">PLAIN_FORMAT</span><span class="plain">) &amp;&amp;</span>
            <span class="plain">(</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">) &gt; 0) &amp;&amp;</span>
            <span class="plain">(</span><span class="functiontext">Regexp::white_space</span><span class="plain">(</span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">)) == </span><span class="constant">FALSE</span><span class="plain">))</span>
                <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;now_extracting</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2">&#167;2</a>.</p>

<p class="inwebparagraph"><a id="SP2_3"></a><b>&#167;2.3.  </b>In EXAMPLE and EXTENSION files, the material is all one tab stop in, so
we get rid of that before passing the line through.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Extract the line</span> <span class="cwebmacronumber">2.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;file_format</span><span class="plain"> == </span><span class="constant">PLAIN_FORMAT</span><span class="plain">) </span><span class="functiontext">Extractor::line_out</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">, </span><span class="identifier">es</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">) == </span><span class="character">'\</span><span class="plain">t</span><span class="character">'</span><span class="plain">) {</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">rl</span><span class="plain">);</span>
            <span class="functiontext">Str::copy</span><span class="plain">(</span><span class="identifier">rl</span><span class="plain">, </span><span class="identifier">line</span><span class="plain">);</span>
            <span class="functiontext">Str::delete_first_character</span><span class="plain">(</span><span class="identifier">rl</span><span class="plain">);</span>
            <span class="functiontext">Extractor::line_out</span><span class="plain">(</span><span class="identifier">rl</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">, </span><span class="identifier">es</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">rl</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::string_is_white_space</span><span class="plain">(</span><span class="identifier">line</span><span class="plain">)) </span><span class="functiontext">Extractor::line_out</span><span class="plain">(</span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">, </span><span class="identifier">es</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2">&#167;2</a>.</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>The effect of the above, then, is that the test case(s) are fed, one line
at a time, into the following function. What happens to these lines depends
on what the Extractor has been asked to do.
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extractor::line_out</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">extraction_state</span><span class="plain"> *</span><span class="identifier">es</span><span class="plain">) {</span>
        <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;extraction_line_count</span><span class="plain">++;</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;extractor_command</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">SOURCE_ACTION</span><span class="plain">: </span>&lt;<span class="cwebmacro">Perform a SOURCE on the line</span> <span class="cwebmacronumber">3.1</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">SCRIPT_ACTION</span><span class="plain">: </span>&lt;<span class="cwebmacro">Perform a SCRIPT on the line</span> <span class="cwebmacronumber">3.2</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">CONCORDANCE_ACTION</span><span class="plain">: </span>&lt;<span class="cwebmacro">Perform a CONCORDANCE on the line</span> <span class="cwebmacronumber">3.4</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">CENSUS_ACTION</span><span class="plain">: </span><span class="reserved">break</span><span class="plain">; </span>    <span class="comment">the content of the cases doesn't matter</span>
        <span class="plain">}</span>
        <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Extractor::line_out is used in <a href="#SP2_1_3">&#167;2.1.3</a>, <a href="#SP2_3">&#167;2.3</a>.</p>

<p class="inwebparagraph"><a id="SP3_1"></a><b>&#167;3.1.  </b>When we SOURCE, we write the line to the text stream <code class="display"><span class="extract">es-&gt;DEST</span></code>, but
we also note in passing whether it contains an Inform 7 "Test me with..."
or "Use command line echoing" sentence.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Perform a SOURCE on the line</span> <span class="cwebmacronumber">3.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">text</span><span class="plain">) &amp;&amp; (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;tc</span><span class="plain">)) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"%c*Test me with \</span><span class="plain">"</span><span class="string">%c*"</span><span class="plain">))</span>
                <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;tc</span><span class="plain">-</span><span class="element">&gt;test_me_detected</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"%c*Use command line echoing%c*"</span><span class="plain">))</span>
                <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;tc</span><span class="plain">-</span><span class="element">&gt;command_line_echoing_detected</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;DEST</span><span class="plain">, </span><span class="string">"%S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">text</span><span class="plain">) </span><span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;DEST</span><span class="plain">, </span><span class="string">"%S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;DEST</span><span class="plain">, </span><span class="string">"\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP3">&#167;3</a>.</p>

<p class="inwebparagraph"><a id="SP3_2"></a><b>&#167;3.2.  </b>On a SCRIPT extraction, we look for the commands in a "Test me with..."
sentence. Again, useful only for Inform 7.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Perform a SCRIPT on the line</span> <span class="cwebmacronumber">3.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">text</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"Test me with \</span><span class="plain">"</span><span class="string">(%c*?)\</span><span class="plain">"</span><span class="string">.*"</span><span class="plain">)) {</span>
                <span class="functiontext">Extractor::script_out</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;DEST</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"Test me with \</span><span class="plain">"</span><span class="string">(%c*?)"</span><span class="plain">)) {</span>
                <span class="functiontext">Extractor::script_out</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;DEST</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
                <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;continue_script</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;continue_script</span><span class="plain">) {</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*?)\</span><span class="plain">"</span><span class="string">%c*?"</span><span class="plain">)) {</span>
                    <span class="functiontext">Extractor::script_out</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;DEST</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
                    <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;continue_script</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
                <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="functiontext">Extractor::script_out</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;DEST</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">);</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP3">&#167;3</a>.</p>

<p class="inwebparagraph"><a id="SP3_3"></a><b>&#167;3.3.  </b>This unpacks a script like <code class="display"><span class="extract">yes / no / maybe</span></code> into a column with one
command per line:
</p>

<p class="inwebparagraph"></p>


<pre class="display">
        <span class="plain">yes</span>
        <span class="plain">no</span>
        <span class="plain">maybe</span>
</pre>

<p class="inwebparagraph">which it pours into the given text stream. All white space around the slashes
is soaked up.
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extractor::script_out</span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">from</span><span class="plain">) {</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">script</span><span class="plain">);</span>
        <span class="functiontext">Str::copy</span><span class="plain">(</span><span class="identifier">script</span><span class="plain">, </span><span class="identifier">from</span><span class="plain">);</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
        <span class="reserved">while</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">script</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c+?) */ *(%c*)"</span><span class="plain">)) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]) &gt; 0) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
            <span class="functiontext">Str::copy</span><span class="plain">(</span><span class="identifier">script</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[1]);</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">script</span><span class="plain">) &gt; 0) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">script</span><span class="plain">);</span>
        <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">script</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Extractor::script_out is used in <a href="#SP3_2">&#167;3.2</a>.</p>

<p class="inwebparagraph"><a id="SP3_4"></a><b>&#167;3.4.  </b>A CONCORDANCE implements the <code class="display"><span class="extract">-concordance</span></code> command-line feature of Inform.
It essentially shows how to reconcile line numbers in the original file with
line numbers in the test case.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Perform a CONCORDANCE on the line</span> <span class="cwebmacronumber">3.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">offset</span><span class="plain"> = </span><span class="identifier">tfp</span><span class="plain">-</span><span class="element">&gt;line_count</span><span class="plain"> - </span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;extraction_line_count</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;concordance_offset</span><span class="plain"> != </span><span class="identifier">offset</span><span class="plain">) {</span>
            <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;concordance_offset</span><span class="plain"> = </span><span class="identifier">offset</span><span class="plain">;</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;DEST</span><span class="plain">, </span><span class="string">"%d +%d\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;extraction_line_count</span><span class="plain">, </span><span class="identifier">offset</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP3">&#167;3</a>.</p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4.  </b>Slightly cheekily, the Extractor with almost all features turned off can
be used as a way to copy a file into a text stream verbatim, like the Unix
<code class="display"><span class="extract">cat</span></code> utility:
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extractor::cat</span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">) {</span>
        <span class="functiontext">Extractor::run</span><span class="plain">(</span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">, </span><span class="constant">PLAIN_FORMAT</span><span class="plain">, 0, </span><span class="constant">SOURCE_ACTION</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Extractor::cat is used in 4/tt (<a href="4-tt.html#SP1_1">&#167;1.1</a>, <a href="4-tt.html#SP1_1_2_3_2_3_3">&#167;1.1.2.3.2.3.3</a>, <a href="4-tt.html#SP1_1_2_3_2_6">&#167;1.1.2.3.2.6</a>).</p>

<!--End of weave: 298 lines from a web of 15211-->
	</body>
</html>

