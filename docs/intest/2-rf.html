<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>1/cla</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
	</head>
	<body>

<!--Weave of '2/rf' generated by 7-->
<ul class="crumbs"><li><a href="../webs.html">&#9733;</a></li><li><a href="index.html">intest 2.0</a></li><li><a href="index.html#2">Chapter 2: Test Cases and Instructions</a></li><li><b>Recipe Files</b></li></ul><p class="purpose">To parse recipe files and/or using commands typed at the command line.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. Recipe files</a></li><li><a href="#SP2">&#167;2. Reading the use command block</a></li><li><a href="#SP2_7_1">&#167;2.7.1. Search path items</a></li><li><a href="#SP5">&#167;5. Scanning and extracting</a></li><li><a href="#SP8">&#167;8. Test cases</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Recipe files. </b>A "recipe file" contains a mixture of "use commands" and "recipes"; the
former fill the universe of test cases, and the latter, which occupy the
bulk of the file, give recipes for how to conduct these test cases.
</p>

<p class="inwebparagraph">Recipe compilation is handled in Chapter 4. Here, we look after the use
commands and the syntac which divides them off from recipes, no more.
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">RecipeFiles::read</span><span class="plain">(</span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">, </span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">, </span><span class="reserved">char</span><span class="plain"> *</span><span class="identifier">err</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">err</span><span class="plain">) </span><span class="functiontext">TextFiles::read</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="identifier">err</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">, &amp;</span><span class="functiontext">RecipeFiles::scan</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="functiontext">TextFiles::read</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, &amp;</span><span class="functiontext">RecipeFiles::scan</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">);</span>
        &lt;<span class="cwebmacro">Finish compiling any inline recipe which has ended</span> <span class="cwebmacronumber">1.5</span>&gt;<span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">RecipeFiles::scan</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">line_text</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">vargs</span><span class="plain">) {</span>
        <span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain"> = </span><span class="identifier">vargs</span><span class="plain">;</span>
        &lt;<span class="cwebmacro">Continue compiling any inline recipe</span> <span class="cwebmacronumber">1.4</span>&gt;<span class="plain">;</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">no_line_tokens</span><span class="plain"> = 0;</span>
        <span class="reserved">text_stream</span><span class="plain"> **</span><span class="identifier">line_tokens</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>

        &lt;<span class="cwebmacro">Tokenise this line</span> <span class="cwebmacronumber">1.1</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">If the line defines a new recipe, inline or external, compile that</span> <span class="cwebmacronumber">1.2</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">Otherwise execute the line as a sequence of use commands</span> <span class="cwebmacronumber">1.3</span>&gt;<span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function RecipeFiles::read is used in <a href="#SP2_6">&#167;2.6</a>, 1/cla (<a href="1-cla.html#SP2_1">&#167;2.1</a>).</p>

<p class="endnote">The function RecipeFiles::scan appears nowhere else.</p>

<p class="inwebparagraph"><a id="SP1_1"></a><b>&#167;1.1.  </b>It would be nicer to store these tokens in a linked list of unbounded
size, rather than a bounded array, but this makes it easier to share code
with the routine parsing the command line. In any case, nobody will hit:
</p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">MAX_LINE_TOKENS</span><span class="plain"> 128</span>
</pre>

<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Tokenise this line</span> <span class="cwebmacronumber">1.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">line_tokens</span><span class="plain"> = </span><span class="functiontext">Memory::I7_calloc</span><span class="plain">(</span><span class="constant">MAX_LINE_TOKENS</span><span class="plain">, </span><span class="reserved">sizeof</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *),</span>
            <span class="constant">COMMAND_HISTORY_MREASON</span><span class="plain">);</span>

        <span class="reserved">string_position</span><span class="plain"> </span><span class="identifier">pos</span><span class="plain"> = </span><span class="functiontext">Str::start</span><span class="plain">(</span><span class="identifier">line_text</span><span class="plain">);</span>
        <span class="reserved">while</span><span class="plain"> (</span><span class="constant">TRUE</span><span class="plain">) {</span>
            <span class="reserved">while</span><span class="plain"> (</span><span class="functiontext">Regexp::white_space</span><span class="plain">(</span><span class="functiontext">Str::get</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">))) </span><span class="identifier">pos</span><span class="plain"> = </span><span class="functiontext">Str::forward</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">);</span>
            <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="functiontext">Str::get</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">c</span><span class="plain"> == 0) || (</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">'!'</span><span class="plain">)) </span><span class="reserved">break</span><span class="plain">;</span>

            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">no_line_tokens</span><span class="plain"> == </span><span class="constant">MAX_LINE_TOKENS</span><span class="plain">) {</span>
                <span class="functiontext">Errors::in_text_file</span><span class="plain">(</span><span class="string">"line has too many tokens"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); </span><span class="reserved">return</span><span class="plain">;</span>
            <span class="plain">}</span>

            <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">tok</span><span class="plain"> = </span><span class="functiontext">Str::new</span><span class="plain">();</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::get</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">) == </span><span class="character">'\</span><span class="plain">'</span><span class="character">'</span><span class="plain">) {</span>
                <span class="identifier">pos</span><span class="plain"> = </span><span class="functiontext">Str::forward</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">);</span>
                <span class="reserved">int</span><span class="plain"> </span><span class="identifier">escaped</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
                <span class="reserved">while</span><span class="plain"> ((</span><span class="functiontext">Str::get</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">)) &amp;&amp; ((</span><span class="identifier">escaped</span><span class="plain"> == </span><span class="constant">FALSE</span><span class="plain">) &amp;&amp; (</span><span class="functiontext">Str::get</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">) != </span><span class="character">'\</span><span class="plain">'</span><span class="character">'</span><span class="plain">))) {</span>
                    <span class="identifier">escaped</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::get</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">) == </span><span class="character">'\</span><span class="plain">\</span><span class="character">'</span><span class="plain">) </span><span class="identifier">escaped</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                    <span class="identifier">PUT_TO</span><span class="plain">(</span><span class="identifier">tok</span><span class="plain">, </span><span class="functiontext">Str::get</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">));</span>
                    <span class="identifier">pos</span><span class="plain"> = </span><span class="functiontext">Str::forward</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">);</span>
                <span class="plain">}</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::get</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">) == </span><span class="character">'\</span><span class="plain">'</span><span class="character">'</span><span class="plain">) </span><span class="identifier">pos</span><span class="plain"> = </span><span class="functiontext">Str::forward</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">);</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
                <span class="reserved">while</span><span class="plain"> ((</span><span class="functiontext">Str::get</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">)) &amp;&amp; (!</span><span class="functiontext">Regexp::white_space</span><span class="plain">(</span><span class="functiontext">Str::get</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">)))) {</span>
                    <span class="identifier">PUT_TO</span><span class="plain">(</span><span class="identifier">tok</span><span class="plain">, </span><span class="functiontext">Str::get</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">));</span>
                    <span class="identifier">pos</span><span class="plain"> = </span><span class="functiontext">Str::forward</span><span class="plain">(</span><span class="identifier">pos</span><span class="plain">);</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
            <span class="identifier">line_tokens</span><span class="plain">[</span><span class="identifier">no_line_tokens</span><span class="plain">++] = </span><span class="identifier">tok</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_2"></a><b>&#167;1.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">If the line defines a new recipe, inline or external, compile that</span> <span class="cwebmacronumber">1.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">no_line_tokens</span><span class="plain"> &gt; 0) &amp;&amp; (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">line_tokens</span><span class="plain">[0], </span><span class="identifier">I</span><span class="string">"-recipe"</span><span class="plain">))) {</span>
            <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain"> = </span><span class="identifier">I</span><span class="string">"[Recipe]"</span><span class="plain">;</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">pos</span><span class="plain"> = 1, </span><span class="identifier">ext</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">no_line_tokens</span><span class="plain"> &gt; </span><span class="identifier">pos</span><span class="plain">) &amp;&amp;</span>
                <span class="plain">(</span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">line_tokens</span><span class="plain">[</span><span class="identifier">pos</span><span class="plain">]) == </span><span class="character">'['</span><span class="plain">) &amp;&amp;</span>
                <span class="plain">(</span><span class="functiontext">Str::get_last_char</span><span class="plain">(</span><span class="identifier">line_tokens</span><span class="plain">[</span><span class="identifier">pos</span><span class="plain">]) == </span><span class="character">']'</span><span class="plain">))</span>
                <span class="identifier">name</span><span class="plain"> = </span><span class="identifier">line_tokens</span><span class="plain">[</span><span class="identifier">pos</span><span class="plain">++];</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">no_line_tokens</span><span class="plain"> &gt; </span><span class="identifier">pos</span><span class="plain">) {</span>
                <span class="functiontext">Delia::compile</span><span class="plain">(</span><span class="functiontext">Filenames::from_text</span><span class="plain">(</span><span class="identifier">line_tokens</span><span class="plain">[</span><span class="identifier">pos</span><span class="plain">++]), </span><span class="identifier">name</span><span class="plain">); </span><span class="identifier">ext</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="plain">}</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">no_line_tokens</span><span class="plain"> != </span><span class="identifier">pos</span><span class="plain">) {</span>
                <span class="functiontext">Errors::in_text_file</span><span class="plain">(</span><span class="string">"malformed -recipe"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); </span><span class="reserved">return</span><span class="plain">;</span>
            <span class="plain">}</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ext</span><span class="plain"> == </span><span class="constant">FALSE</span><span class="plain">) </span>&lt;<span class="cwebmacro">Begin compiling an inline recipe</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
            <span class="reserved">return</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_3"></a><b>&#167;1.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Otherwise execute the line as a sequence of use commands</span> <span class="cwebmacronumber">1.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="functiontext">RecipeFiles::read_using_instructions</span><span class="plain">(</span><span class="identifier">args</span><span class="plain">, 0, </span><span class="identifier">no_line_tokens</span><span class="plain">, </span><span class="identifier">line_tokens</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;home</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_2_1"></a><b>&#167;1.2.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Begin compiling an inline recipe</span> <span class="cwebmacronumber">1.2.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;compiling_recipe</span><span class="plain"> = </span><span class="functiontext">Delia::begin_compilation</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1_2">&#167;1.2</a>.</p>

<p class="inwebparagraph"><a id="SP1_4"></a><b>&#167;1.4.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Continue compiling any inline recipe</span> <span class="cwebmacronumber">1.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;compiling_recipe</span><span class="plain">) {</span>
            <span class="functiontext">Delia::compile_line</span><span class="plain">(</span><span class="identifier">line_text</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">, (</span><span class="reserved">void</span><span class="plain"> *) </span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;compiling_recipe</span><span class="plain">);</span>
            &lt;<span class="cwebmacro">Finish compiling any inline recipe which has ended</span> <span class="cwebmacronumber">1.5</span>&gt;<span class="plain">;</span>
            <span class="reserved">return</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_5"></a><b>&#167;1.5.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Finish compiling any inline recipe which has ended</span> <span class="cwebmacronumber">1.5</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;compiling_recipe</span><span class="plain">)</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;compiling_recipe</span><span class="plain">-</span><span class="element">&gt;end_found</span><span class="plain">) {</span>
                <span class="functiontext">Delia::end_compilation</span><span class="plain">(</span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;compiling_recipe</span><span class="plain">);</span>
                <span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;compiling_recipe</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
            <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>, <a href="#SP1_4">&#167;1.4</a>.</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2. Reading the use command block. </b>The following parses and acts upon a series of use command tokens. Though
the prototype of the function looks like something which only parses a
chunk of the command line, in fact it also parses lines of tokens from
recipe files (see above).
</p>

<p class="inwebparagraph">At any rate, we have a line to tokens <code class="display"><span class="extract">USE1 USE2 ...USEn</span></code>, somewhere in
the array <code class="display"><span class="extract">argv</span></code>. <code class="display"><span class="extract">from_arg_n</span></code> is the index of <code class="display"><span class="extract">USE1</span></code>, and <code class="display"><span class="extract">to_arg_n</span></code> is
the index after <code class="display"><span class="extract">USEn</span></code>.
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">RecipeFiles::read_using_instructions</span><span class="plain">(</span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">,</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">from_arg_n</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">to_arg_n</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> **</span><span class="identifier">argv</span><span class="plain">, </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">project</span><span class="plain">) {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">t</span><span class="plain"> = </span><span class="constant">NO_SPT</span><span class="plain">, </span><span class="identifier">multiple</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">, </span><span class="identifier">allowed_to_execute</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">recipe_name</span><span class="plain">);</span>
        <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">recipe_name</span><span class="plain">, </span><span class="string">"[Recipe]"</span><span class="plain">);</span>
        &lt;<span class="cwebmacro">Log the using instructions</span> <span class="cwebmacronumber">2.1</span>&gt;<span class="plain">;</span>
        <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=</span><span class="identifier">from_arg_n</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="identifier">to_arg_n</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++) {</span>
            <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">opt</span><span class="plain"> = </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">];</span>

            &lt;<span class="cwebmacro">Act on if or endif</span> <span class="cwebmacronumber">2.2</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Act on set</span> <span class="cwebmacronumber">2.3</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Act on a case type choice</span> <span class="cwebmacronumber">2.4</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Act on a recipe choice</span> <span class="cwebmacronumber">2.5</span>&gt;<span class="plain">;</span>

            <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
            <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">multiple</span><span class="plain">) </span><span class="identifier">P</span><span class="plain"> = </span><span class="functiontext">Pathnames::from_text</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">);</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="identifier">F</span><span class="plain"> = </span><span class="functiontext">Filenames::from_text</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">);</span>

            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">t</span><span class="plain"> == </span><span class="constant">NO_SPT</span><span class="plain">) </span>&lt;<span class="cwebmacro">Load in a file of further using instructions</span> <span class="cwebmacronumber">2.6</span>&gt;
            <span class="reserved">else</span><span class="plain"> </span>&lt;<span class="cwebmacro">Execute this as a using instruction</span> <span class="cwebmacronumber">2.7</span>&gt;<span class="plain">;</span>
        <span class="plain">}</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">recipe_name</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function RecipeFiles::read_using_instructions is used in <a href="#SP1_3">&#167;1.3</a>, 1/cla (<a href="1-cla.html#SP2_1">&#167;2.1</a>).</p>

<p class="inwebparagraph"><a id="SP2_1"></a><b>&#167;2.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Log the using instructions</span> <span class="cwebmacronumber">2.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Log::aspect_switched_on</span><span class="plain">(</span><span class="constant">INSTRUCTIONS_DA</span><span class="plain">)) {</span>
            <span class="identifier">LOG</span><span class="plain">(</span><span class="string">"using:"</span><span class="plain">);</span>
            <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=</span><span class="identifier">from_arg_n</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="identifier">to_arg_n</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++) </span><span class="identifier">LOG</span><span class="plain">(</span><span class="string">" %S"</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">]);</span>
            <span class="identifier">LOG</span><span class="plain">(</span><span class="string">"\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2">&#167;2</a>.</p>

<p class="inwebparagraph"><a id="SP2_2"></a><b>&#167;2.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Act on if or endif</span> <span class="cwebmacronumber">2.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-if"</span><span class="plain">)) &amp;&amp; (</span><span class="identifier">i</span><span class="plain">+1&lt;</span><span class="identifier">to_arg_n</span><span class="plain">)) {</span>
            <span class="identifier">allowed_to_execute</span><span class="plain"> = </span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">+1], </span><span class="functiontext">Globals::get_platform</span><span class="plain">());</span>
            <span class="identifier">LOGIF</span><span class="plain">(</span><span class="identifier">INSTRUCTIONS</span><span class="plain">,</span>
                <span class="string">"using: -if %S (platform %S): %s\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">+1], </span><span class="functiontext">Globals::get_platform</span><span class="plain">(),</span>
                    <span class="identifier">allowed_to_execute</span><span class="plain">?</span><span class="string">"yes"</span><span class="plain">:</span><span class="string">"no"</span><span class="plain">);</span>
            <span class="identifier">i</span><span class="plain">++; </span><span class="reserved">continue</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq_wide_string</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"-endif"</span><span class="plain">)) { </span><span class="identifier">allowed_to_execute</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">; </span><span class="reserved">continue</span><span class="plain">; }</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">allowed_to_execute</span><span class="plain"> == </span><span class="constant">FALSE</span><span class="plain">) </span><span class="reserved">continue</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2">&#167;2</a>.</p>

<p class="inwebparagraph"><a id="SP2_3"></a><b>&#167;2.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Act on set</span> <span class="cwebmacronumber">2.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext">Str::eq_wide_string</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"-set"</span><span class="plain">)) &amp;&amp; (</span><span class="identifier">i</span><span class="plain">+2&lt;</span><span class="identifier">to_arg_n</span><span class="plain">)) {</span>
            <span class="functiontext">Globals::create</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">+1]);</span>
            <span class="functiontext">Globals::set</span><span class="plain">(</span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">+1], </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">+2]);</span>
            <span class="identifier">i</span><span class="plain"> += 2; </span><span class="reserved">continue</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2">&#167;2</a>.</p>

<p class="inwebparagraph"><a id="SP2_4"></a><b>&#167;2.4.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Act on a case type choice</span> <span class="cwebmacronumber">2.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-extension"</span><span class="plain">)) { </span><span class="identifier">t</span><span class="plain"> = </span><span class="constant">EXTENSION_SPT</span><span class="plain">; </span><span class="reserved">continue</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-case"</span><span class="plain">)) { </span><span class="identifier">t</span><span class="plain"> = </span><span class="constant">CASE_SPT</span><span class="plain">; </span><span class="reserved">continue</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-problem"</span><span class="plain">)) { </span><span class="identifier">t</span><span class="plain"> = </span><span class="constant">PROBLEM_SPT</span><span class="plain">; </span><span class="reserved">continue</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-map"</span><span class="plain">)) { </span><span class="identifier">t</span><span class="plain"> = </span><span class="constant">MAP_SPT</span><span class="plain">; </span><span class="reserved">continue</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-example"</span><span class="plain">)) { </span><span class="identifier">t</span><span class="plain"> = </span><span class="constant">EXAMPLE_SPT</span><span class="plain">; </span><span class="reserved">continue</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-extensions"</span><span class="plain">)) { </span><span class="identifier">t</span><span class="plain"> = </span><span class="constant">EXTENSION_SPT</span><span class="plain">; </span><span class="identifier">multiple</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">; </span><span class="reserved">continue</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-cases"</span><span class="plain">)) { </span><span class="identifier">t</span><span class="plain"> = </span><span class="constant">CASE_SPT</span><span class="plain">; </span><span class="identifier">multiple</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">; </span><span class="reserved">continue</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-problems"</span><span class="plain">)) { </span><span class="identifier">t</span><span class="plain"> = </span><span class="constant">PROBLEM_SPT</span><span class="plain">; </span><span class="identifier">multiple</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">; </span><span class="reserved">continue</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-maps"</span><span class="plain">)) { </span><span class="identifier">t</span><span class="plain"> = </span><span class="constant">MAP_SPT</span><span class="plain">; </span><span class="identifier">multiple</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">; </span><span class="reserved">continue</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"-examples"</span><span class="plain">)) { </span><span class="identifier">t</span><span class="plain"> = </span><span class="constant">EXAMPLE_SPT</span><span class="plain">; </span><span class="identifier">multiple</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">; </span><span class="reserved">continue</span><span class="plain">; }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">) == </span><span class="character">'-'</span><span class="plain">) </span><span class="functiontext">Errors::fatal</span><span class="plain">(</span><span class="string">"unrecognised -using case type"</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2">&#167;2</a>.</p>

<p class="inwebparagraph"><a id="SP2_5"></a><b>&#167;2.5.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Act on a recipe choice</span> <span class="cwebmacronumber">2.5</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">) == </span><span class="character">'['</span><span class="plain">) &amp;&amp; (</span><span class="functiontext">Str::get_last_char</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">) == </span><span class="character">']'</span><span class="plain">)) {</span>
            <span class="functiontext">Str::copy</span><span class="plain">(</span><span class="identifier">recipe_name</span><span class="plain">, </span><span class="identifier">opt</span><span class="plain">); </span><span class="reserved">continue</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2">&#167;2</a>.</p>

<p class="inwebparagraph"><a id="SP2_6"></a><b>&#167;2.6.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Load in a file of further using instructions</span> <span class="cwebmacronumber">2.6</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="functiontext">RecipeFiles::read</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">, </span><span class="string">"can't open using instructions file"</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2">&#167;2</a>.</p>

<p class="inwebparagraph"><a id="SP2_7"></a><b>&#167;2.7.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Execute this as a using instruction</span> <span class="cwebmacronumber">2.7</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">cases_within</span><span class="plain"> = </span><span class="identifier">NEW_LINKED_LIST</span><span class="plain">(</span><span class="reserved">test_case</span><span class="plain">);</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">multiple</span><span class="plain">) </span><span class="functiontext">RecipeFiles::scan_directory_for_cases</span><span class="plain">(</span><span class="identifier">cases_within</span><span class="plain">, </span><span class="identifier">t</span><span class="plain">, </span><span class="identifier">P</span><span class="plain">, </span><span class="identifier">project</span><span class="plain">, </span><span class="identifier">recipe_name</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="functiontext">RecipeFiles::scan_file_for_cases</span><span class="plain">(</span><span class="identifier">cases_within</span><span class="plain">, </span><span class="identifier">t</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">, </span><span class="identifier">recipe_name</span><span class="plain">);</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">LinkedLists::len</span><span class="plain">(</span><span class="identifier">cases_within</span><span class="plain">) &gt; 0) </span>&lt;<span class="cwebmacro">Create a search path item</span> <span class="cwebmacronumber">2.7.2</span>&gt;<span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2">&#167;2</a>.</p>

<p class="inwebparagraph"><a id="SP2_7_1"></a><b>&#167;2.7.1. Search path items. </b>Each of these represents a place in the file system where test cases may
be found: either as a specific file, or a directory. It also comes with
a "search path type", telling Intest how the test case will be stored.
There are five basic search path types:
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">NO_SPT</span><span class="definitionkeyword"> from </span><span class="constant">0</span>
    <span class="definitionkeyword">enum</span> <span class="constant">EXTENSION_SPT</span>
    <span class="definitionkeyword">enum</span> <span class="constant">CASE_SPT</span>
    <span class="definitionkeyword">enum</span> <span class="constant">PROBLEM_SPT</span>
    <span class="definitionkeyword">enum</span> <span class="constant">EXAMPLE_SPT</span>
    <span class="definitionkeyword">enum</span> <span class="constant">MAP_SPT</span>
</pre>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">search_path_item</span><span class="plain"> {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">search_path_type</span><span class="plain">; </span>    <span class="comment">one of the <code class="display"><span class="extract">_SPT</span></code> cases above</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">multiple</span><span class="plain">; </span>    <span class="comment">is this a pathname to a folder?</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">exactly_this</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">within_this</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">contents</span><span class="plain">; </span>    <span class="comment">of <code class="display"><span class="extract">test_case</span></code></span>
        <span class="constant">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">search_path_item</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure search_path_item is accessed in 2/act and here.</p>

<p class="inwebparagraph"><a id="SP2_7_2"></a><b>&#167;2.7.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Create a search path item</span> <span class="cwebmacronumber">2.7.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">search_path_item</span><span class="plain"> *</span><span class="identifier">spi</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">search_path_item</span><span class="plain">);</span>
        <span class="identifier">spi</span><span class="plain">-</span><span class="element">&gt;search_path_type</span><span class="plain"> = </span><span class="identifier">t</span><span class="plain">;</span>
        <span class="identifier">spi</span><span class="plain">-</span><span class="element">&gt;multiple</span><span class="plain"> = </span><span class="identifier">multiple</span><span class="plain">;</span>
        <span class="identifier">spi</span><span class="plain">-</span><span class="element">&gt;within_this</span><span class="plain"> = </span><span class="identifier">P</span><span class="plain">;</span>
        <span class="identifier">spi</span><span class="plain">-</span><span class="element">&gt;exactly_this</span><span class="plain"> = </span><span class="identifier">F</span><span class="plain">;</span>
        <span class="identifier">spi</span><span class="plain">-</span><span class="element">&gt;contents</span><span class="plain"> = </span><span class="identifier">cases_within</span><span class="plain">;</span>
        <span class="identifier">ADD_TO_LINKED_LIST</span><span class="plain">(</span><span class="identifier">spi</span><span class="plain">, </span><span class="reserved">search_path_item</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;search_path</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2_7">&#167;2.7</a>.</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b></p>


<pre class="display">
    <span class="reserved">test_case</span><span class="plain"> *</span><span class="functiontext">RecipeFiles::find_case</span><span class="plain">(</span><span class="reserved">intest_instructions</span><span class="plain"> *</span><span class="identifier">args</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain">) {</span>
        <span class="reserved">search_path_item</span><span class="plain"> *</span><span class="identifier">spi</span><span class="plain">;</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">spi</span><span class="plain">, </span><span class="reserved">search_path_item</span><span class="plain">, </span><span class="identifier">args</span><span class="plain">-</span><span class="element">&gt;search_path</span><span class="plain">)</span>
            <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">spi</span><span class="plain">-</span><span class="element">&gt;contents</span><span class="plain">)</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_case_name</span><span class="plain">, </span><span class="identifier">name</span><span class="plain">))</span>
                    <span class="reserved">return</span><span class="plain"> </span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">NULL</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function RecipeFiles::find_case is used in 2/act (<a href="2-act.html#SP5">&#167;5</a>), 3/th (<a href="3-th.html#SP4">&#167;4</a>).</p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4.  </b></p>


<pre class="display">
    <span class="reserved">text_stream</span><span class="plain"> *</span><span class="functiontext">RecipeFiles::case_type_as_text</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">spt</span><span class="plain">) {</span>
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">spt</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">EXTENSION_SPT</span><span class="plain">: </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">I</span><span class="string">"extension"</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">CASE_SPT</span><span class="plain">: </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">I</span><span class="string">"case"</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">PROBLEM_SPT</span><span class="plain">: </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">I</span><span class="string">"problem"</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">EXAMPLE_SPT</span><span class="plain">: </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">I</span><span class="string">"example"</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">MAP_SPT</span><span class="plain">: </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">I</span><span class="string">"map"</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">I</span><span class="string">"unknown"</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function RecipeFiles::case_type_as_text is used in 4/tt (<a href="4-tt.html#SP1_1_2_1">&#167;1.1.2.1</a>).</p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5. Scanning and extracting. </b>The following looks for all the test cases it can find in a directory <code class="display"><span class="extract">P</span></code>.
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">RecipeFiles::scan_directory_for_cases</span><span class="plain">(</span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">,</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">t</span><span class="plain">, </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain">, </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">project</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">rn</span><span class="plain">) {</span>
        <span class="reserved">scan_directory</span><span class="plain"> *</span><span class="identifier">FOLD</span><span class="plain"> = </span><span class="functiontext">Directories::open</span><span class="plain">(</span><span class="identifier">P</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">FOLD</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="functiontext">Errors::fatal_with_path</span><span class="plain">(</span><span class="string">"unable to open test cases folder"</span><span class="plain">, </span><span class="identifier">P</span><span class="plain">);</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">leafname</span><span class="plain">);</span>
        <span class="reserved">while</span><span class="plain"> (</span><span class="functiontext">Directories::next</span><span class="plain">(</span><span class="identifier">FOLD</span><span class="plain">, </span><span class="identifier">leafname</span><span class="plain">)) {</span>
            <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">first</span><span class="plain"> = </span><span class="functiontext">Str::get_first_char</span><span class="plain">(</span><span class="identifier">leafname</span><span class="plain">), </span><span class="identifier">last</span><span class="plain"> = </span><span class="functiontext">Str::get_last_char</span><span class="plain">(</span><span class="identifier">leafname</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">last</span><span class="plain"> == </span><span class="constant">FOLDER_SEPARATOR</span><span class="plain">) </span><span class="reserved">continue</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">first</span><span class="plain"> == </span><span class="character">'.'</span><span class="plain">) </span><span class="reserved">continue</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">first</span><span class="plain"> == </span><span class="character">'('</span><span class="plain">) </span><span class="reserved">continue</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">first</span><span class="plain"> == </span><span class="character">'-'</span><span class="plain">) ||</span>
                <span class="plain">(</span><span class="identifier">first</span><span class="plain"> == </span><span class="character">'['</span><span class="plain">) ||</span>
                <span class="plain">(</span><span class="functiontext">Actions::identify_wildcard</span><span class="plain">(</span><span class="identifier">leafname</span><span class="plain">) != </span><span class="constant">TAMECARD</span><span class="plain">))</span>
                <span class="functiontext">Errors::fatal_with_text</span><span class="plain">(</span><span class="string">"no test can legally be called '%S'"</span><span class="plain">, </span><span class="identifier">leafname</span><span class="plain">);</span>
            <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="functiontext">Filenames::in_folder</span><span class="plain">(</span><span class="identifier">P</span><span class="plain">, </span><span class="identifier">leafname</span><span class="plain">);</span>
            <span class="functiontext">RecipeFiles::scan_file_for_cases</span><span class="plain">(</span><span class="identifier">L</span><span class="plain">, </span><span class="identifier">t</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">, </span><span class="identifier">rn</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">leafname</span><span class="plain">);</span>
        <span class="functiontext">Directories::close</span><span class="plain">(</span><span class="identifier">FOLD</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function RecipeFiles::scan_directory_for_cases is used in <a href="#SP2_7">&#167;2.7</a>.</p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6.  </b>And this in turn is called when one or more test cases are to be extracted
from a specific single file. (Note that a single Inform 7 extension file can
contain multiple examples, each generating a test case, so it really can be
more than one.)
</p>


<pre class="display">
    <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">extraction_file</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">RecipeFiles::scan_file_for_cases</span><span class="plain">(</span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">t</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">rn</span><span class="plain">) {</span>
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">t</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">EXTENSION_SPT</span><span class="plain">: </span>&lt;<span class="cwebmacro">Adopt Example cases from an extension file</span> <span class="cwebmacronumber">6.2</span>&gt;<span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">CASE_SPT</span><span class="plain">: </span><span class="reserved">case</span><span class="plain"> </span><span class="constant">PROBLEM_SPT</span><span class="plain">: </span><span class="reserved">case</span><span class="plain"> </span><span class="constant">MAP_SPT</span><span class="plain">:</span>
                &lt;<span class="cwebmacro">Adopt a single test case not needing extraction</span> <span class="cwebmacronumber">6.1</span>&gt;<span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">EXAMPLE_SPT</span><span class="plain">: </span>&lt;<span class="cwebmacro">Adopt Example cases from an example file</span> <span class="cwebmacronumber">6.3</span>&gt;<span class="plain">;</span>
            <span class="reserved">default</span><span class="plain">: </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"bad search path type"</span><span class="plain">);</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function RecipeFiles::scan_file_for_cases is used in <a href="#SP2_7">&#167;2.7</a>, <a href="#SP5">&#167;5</a>.</p>

<p class="inwebparagraph"><a id="SP6_1"></a><b>&#167;6.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Adopt a single test case not needing extraction</span> <span class="cwebmacronumber">6.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain"> = </span><span class="functiontext">RecipeFiles::new_case</span><span class="plain">(</span><span class="identifier">t</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">, </span><span class="constant">PLAIN_FORMAT</span><span class="plain">, 0, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">rn</span><span class="plain">);</span>
        <span class="identifier">ADD_TO_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">);</span>
        <span class="reserved">break</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP6_2"></a><b>&#167;6.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Adopt Example cases from an extension file</span> <span class="cwebmacronumber">6.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">extraction_file</span><span class="plain"> = </span><span class="identifier">F</span><span class="plain">;</span>
        <span class="functiontext">Extractor::run</span><span class="plain">(</span><span class="identifier">L</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">, </span><span class="constant">EXTENSION_FORMAT</span><span class="plain">, 0, </span><span class="constant">CENSUS_ACTION</span><span class="plain">, </span><span class="identifier">rn</span><span class="plain">);</span>
        <span class="reserved">break</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP6_3"></a><b>&#167;6.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Adopt Example cases from an example file</span> <span class="cwebmacronumber">6.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">extraction_file</span><span class="plain"> = </span><span class="identifier">F</span><span class="plain">;</span>
        <span class="functiontext">Extractor::run</span><span class="plain">(</span><span class="identifier">L</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">, </span><span class="constant">EXAMPLE_FORMAT</span><span class="plain">, 0, </span><span class="constant">CENSUS_ACTION</span><span class="plain">, </span><span class="identifier">rn</span><span class="plain">);</span>
        <span class="reserved">break</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP7"></a><b>&#167;7.  </b>These functions are called by the Extractor when it finds a test case in
the relevant example or extension file. (Those are both Inform 7-only
features.)
</p>


<pre class="display">
    <span class="reserved">test_case</span><span class="plain"> *</span><span class="functiontext">RecipeFiles::observe_in_extension</span><span class="plain">(</span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">count</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">force_vm</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">rn</span><span class="plain">) {</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain"> = </span><span class="functiontext">RecipeFiles::new_case</span><span class="plain">(</span><span class="constant">EXTENSION_SPT</span><span class="plain">, </span><span class="identifier">extraction_file</span><span class="plain">, </span><span class="constant">EXTENSION_FORMAT</span><span class="plain">, </span><span class="identifier">count</span><span class="plain">, </span><span class="identifier">force_vm</span><span class="plain">, </span><span class="identifier">rn</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">L</span><span class="plain">) </span><span class="identifier">ADD_TO_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">tc</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">test_case</span><span class="plain"> *</span><span class="functiontext">RecipeFiles::observe_in_example</span><span class="plain">(</span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">force_vm</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">rn</span><span class="plain">) {</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain"> = </span><span class="functiontext">RecipeFiles::new_case</span><span class="plain">(</span><span class="constant">EXAMPLE_SPT</span><span class="plain">, </span><span class="identifier">extraction_file</span><span class="plain">, </span><span class="constant">EXAMPLE_FORMAT</span><span class="plain">, 0, </span><span class="identifier">force_vm</span><span class="plain">, </span><span class="identifier">rn</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">L</span><span class="plain">) </span><span class="identifier">ADD_TO_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">tc</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function RecipeFiles::observe_in_extension is used in 2/te (<a href="2-te.html#SP2_1_3">&#167;2.1.3</a>).</p>

<p class="endnote">The function RecipeFiles::observe_in_example is used in 2/te (<a href="2-te.html#SP2_1_2">&#167;2.1.2</a>).</p>

<p class="inwebparagraph"><a id="SP8"></a><b>&#167;8. Test cases. </b>The content of a test case lives in a single file, but may live in only part
of that file. The file can have three possible formats, though two of them
arise only for Inform 7.
</p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">PLAIN_FORMAT</span><span class="plain"> 1 </span>    <span class="comment">the file as a whole is one case</span>
    <span class="definitionkeyword">define</span> <span class="constant">EXAMPLE_FORMAT</span><span class="plain"> 2 </span>    <span class="comment">Inform example file discussing code which forms one case</span>
    <span class="definitionkeyword">define</span> <span class="constant">EXTENSION_FORMAT</span><span class="plain"> 3 </span>    <span class="comment">Inform extension file containing examples A, B, C, ...</span>
</pre>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">test_case</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">test_location</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">format_reference</span><span class="plain">; </span>    <span class="comment">one of the <code class="display"><span class="extract">_FORMAT</span></code> constants above</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">letter_reference</span><span class="plain">; </span>    <span class="comment">1 for A, 2 for B, ..., or 0 for none</span>

        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">test_case_name</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">test_case_title</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">test_recipe_name</span><span class="plain">; </span>    <span class="comment">such as <code class="display"><span class="extract">[Recipe]</span></code></span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">test_type</span><span class="plain">; </span>    <span class="comment">one of the <code class="display"><span class="extract">_SPT</span></code> constants above</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">cursed</span><span class="plain">; </span>    <span class="comment">currently has no ideal output to test against</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">known_hash</span><span class="plain">; </span>    <span class="comment">md5 hash of known-correct code</span>

        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">work_area</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">commands_location</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">test_me_detected</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">command_line_echoing_detected</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">left_bracket</span><span class="plain">, </span><span class="identifier">right_bracket</span><span class="plain">;</span>
        <span class="constant">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">test_case</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure test_case is accessed in 2/act, 2/te, 3/ts, 3/th, 3/tr, 4/tt and here.</p>

<p class="inwebparagraph"><a id="SP9"></a><b>&#167;9.  </b></p>


<pre class="display">
    <span class="reserved">test_case</span><span class="plain"> *</span><span class="functiontext">RecipeFiles::new_case</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">t</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">fref</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">ref</span><span class="plain">,</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">force_vm</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">recipe_name</span><span class="plain">) {</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">test_case</span><span class="plain">);</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_case_name</span><span class="plain"> = </span><span class="functiontext">Str::new</span><span class="plain">();</span>
        <span class="functiontext">Filenames::write_unextended_leafname</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_case_name</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ref</span><span class="plain"> &gt; 0) </span><span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_case_name</span><span class="plain">, </span><span class="string">" Example %c"</span><span class="plain">, </span><span class="character">'A'</span><span class="plain">+</span><span class="identifier">ref</span><span class="plain">-1);</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_case_title</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_recipe_name</span><span class="plain"> = </span><span class="functiontext">Str::duplicate</span><span class="plain">(</span><span class="identifier">recipe_name</span><span class="plain">);</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_type</span><span class="plain"> = </span><span class="identifier">t</span><span class="plain">;</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_location</span><span class="plain"> = </span><span class="identifier">F</span><span class="plain">;</span>
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">G</span><span class="plain"> = </span><span class="identifier">F</span><span class="plain">;</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;work_area</span><span class="plain"> = </span><span class="functiontext">Filenames::get_path_to</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">t</span><span class="plain"> == </span><span class="constant">EXTENSION_SPT</span><span class="plain">) {</span>
            <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain"> = </span><span class="functiontext">Globals::to_pathname</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"extensions_testing_area"</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">P</span><span class="plain">) {</span>
                <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">);</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">, </span><span class="string">"%S.txt"</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_case_name</span><span class="plain">);</span>
                <span class="identifier">G</span><span class="plain"> = </span><span class="functiontext">Filenames::in_folder</span><span class="plain">(</span><span class="identifier">P</span><span class="plain">, </span><span class="identifier">leaf</span><span class="plain">);</span>
                <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">);</span>
                <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;work_area</span><span class="plain"> = </span><span class="identifier">P</span><span class="plain">;</span>
            <span class="plain">}</span>
        <span class="plain">}</span>

        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">DG</span><span class="plain"> = </span><span class="functiontext">Filenames::set_extension</span><span class="plain">(</span><span class="identifier">G</span><span class="plain">, </span><span class="string">"txt"</span><span class="plain">);</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;commands_location</span><span class="plain"> = </span><span class="functiontext">Filenames::in_folder</span><span class="plain">(</span>
            <span class="functiontext">Pathnames::from_text_relative</span><span class="plain">(</span><span class="functiontext">Filenames::get_path_to</span><span class="plain">(</span><span class="identifier">DG</span><span class="plain">), </span><span class="identifier">I</span><span class="string">"_Command_Scripts"</span><span class="plain">),</span>
            <span class="functiontext">Filenames::get_leafname</span><span class="plain">(</span><span class="identifier">DG</span><span class="plain">));</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;format_reference</span><span class="plain"> = </span><span class="identifier">fref</span><span class="plain">;</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;letter_reference</span><span class="plain"> = </span><span class="identifier">ref</span><span class="plain">;</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_me_detected</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;command_line_echoing_detected</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;cursed</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;known_hash</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;left_bracket</span><span class="plain"> = </span><span class="character">'{'</span><span class="plain">; </span><span class="identifier">tc</span><span class="plain">-&gt;</span><span class="identifier">right_bracket</span><span class="plain"> = </span><span class="character">'}'</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">tc</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">RecipeFiles::NameTestCase</span><span class="plain">(</span><span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">title</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">tc</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"naming null test case"</span><span class="plain">);</span>
        <span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_case_title</span><span class="plain"> = </span><span class="functiontext">Str::duplicate</span><span class="plain">(</span><span class="identifier">title</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function RecipeFiles::new_case is used in <a href="#SP6_1">&#167;6.1</a>, <a href="#SP7">&#167;7</a>.</p>

<p class="endnote">The function RecipeFiles::NameTestCase is used in 2/te (<a href="2-te.html#SP2_1_1">&#167;2.1.1</a>, <a href="2-te.html#SP2_1_2">&#167;2.1.2</a>, <a href="2-te.html#SP2_1_3">&#167;2.1.3</a>).</p>

<p class="inwebparagraph"><a id="SP10"></a><b>&#167;10.  </b>The following is the back end for the <code class="display"><span class="extract">-find</span></code> do action, and lists all
test cases whose names or titles match a given regular expression. If the
<code class="display"><span class="extract">match</span></code> expression is empty, it lists everything in the search list.
</p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">MAX_NAME_MATCH_LENGTH</span><span class="plain"> 1024</span>
</pre>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">RecipeFiles::perform_catalogue</span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">list</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">match</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">match</span><span class="plain">) &gt; 0) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Test cases matching '%S':\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">match</span><span class="plain">);</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">re</span><span class="plain">);</span>
        <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">re</span><span class="plain">, </span><span class="string">"%%c*%S%%c*"</span><span class="plain">, </span><span class="identifier">match</span><span class="plain">);</span>
        <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">wregexp</span><span class="plain">[</span><span class="constant">MAX_NAME_MATCH_LENGTH</span><span class="plain">];</span>
        <span class="functiontext">Str::copy_to_wide_string</span><span class="plain">(</span><span class="identifier">wregexp</span><span class="plain">, </span><span class="identifier">re</span><span class="plain">, </span><span class="constant">MAX_NAME_MATCH_LENGTH</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">re</span><span class="plain">);</span>
        <span class="reserved">search_path_item</span><span class="plain"> *</span><span class="identifier">spi</span><span class="plain">;</span>
        <span class="reserved">test_case</span><span class="plain"> *</span><span class="identifier">tc</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">spi</span><span class="plain">, </span><span class="reserved">search_path_item</span><span class="plain">, </span><span class="identifier">list</span><span class="plain">)</span>
            <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">, </span><span class="reserved">test_case</span><span class="plain">, </span><span class="identifier">spi</span><span class="plain">-</span><span class="element">&gt;contents</span><span class="plain">) {</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;format_reference</span><span class="plain"> != </span><span class="constant">EXAMPLE_FORMAT</span><span class="plain">) &amp;&amp;</span>
                    <span class="plain">(</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;format_reference</span><span class="plain"> != </span><span class="constant">EXTENSION_FORMAT</span><span class="plain">))</span>
                    <span class="functiontext">Extractor::run</span><span class="plain">(</span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">,</span>
                        <span class="identifier">tc</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_location</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;format_reference</span><span class="plain">, 0, </span><span class="constant">CENSUS_ACTION</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
                <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">match</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) ||</span>
                    <span class="plain">(</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_case_name</span><span class="plain">, </span><span class="identifier">wregexp</span><span class="plain">)) ||</span>
                    <span class="plain">(</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_case_title</span><span class="plain">, </span><span class="identifier">wregexp</span><span class="plain">))) {</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S%s"</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_case_name</span><span class="plain">, (</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_type</span><span class="plain"> == </span><span class="constant">PROBLEM_SPT</span><span class="plain">)?</span><span class="string">" (problem)"</span><span class="plain">:</span><span class="string">""</span><span class="plain">);</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::len</span><span class="plain">(</span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_case_title</span><span class="plain">) &gt; 0) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">" = %S"</span><span class="plain">, </span><span class="identifier">tc</span><span class="plain">-</span><span class="element">&gt;test_case_title</span><span class="plain">);</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
                <span class="plain">}</span>
                <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
            <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function RecipeFiles::perform_catalogue is used in 2/act (<a href="2-act.html#SP8_2">&#167;8.2</a>).</p>

<!--End of weave: 455 lines from a web of 15211-->
	</body>
</html>

