<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Intest at the Command Line</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/ConsoleText-Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<h1><a href="../index.html">
<img src="../docs-assets/Intest.png" height=72">
</a></h1>
<ul><li><a href="index.html"><span class="selectedlink">intest</span></a></li>
</ul><h2>Repository</h2><ul>
<li><a href="https://github.com/ganelson/intest"><img src="../docs-assets/github.png" height=18> github</a></li>
</ul><h2>Related Projects</h2><ul>
<li><a href="../../../inweb/docs/index.html">inweb</a></li>
<li><a href="../../../inform/docs/index.html">inform</a></li>

</ul>
		</nav>
		<main role="main">
		<!--Weave of 'Intest at the Command Line' generated by Inweb-->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">intest</a></li><li><a href="index.html#M">Manual</a></li><li><b>Intest at the Command Line</b></li></ul></div>
<p class="purpose">Intest is controlled with a flexible range of command-line instructions.</p>

<ul class="toc"><li><a href="M-iatcl.html#SP1">&#167;1. Specifying what to test</a></li><li><a href="M-iatcl.html#SP3">&#167;3. History and substitution</a></li><li><a href="M-iatcl.html#SP4">&#167;4. Command line arguments</a></li><li><a href="M-iatcl.html#SP5">&#167;5. The options</a></li><li><a href="M-iatcl.html#SP6">&#167;6. Using</a></li><li><a href="M-iatcl.html#SP7">&#167;7. Doing</a></li><li><a href="M-iatcl.html#SP9">&#167;9. Output redirection</a></li><li><a href="M-iatcl.html#SP10">&#167;10. Reporting on test outcomes in the Inform app</a></li><li><a href="M-iatcl.html#SP11">&#167;11. Skein file testing</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1"></a><b>&#167;1. Specifying what to test. </b>Intest tests just one project at a time, and the first thing to do is
specify which. The general form is:
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    </span><span class="ConsoleText-element-syntax">$</span><span class="ConsoleText-plain-syntax"> </span><span class="ConsoleText-function-syntax">intest/Tangled/intest</span><span class="ConsoleText-plain-syntax"> PROJECT COMMAND</span>
</pre>
<p class="commentary">or, in case the <span class="extract"><span class="ConsoleText-extract-syntax">PROJECT</span></span> directory happens to begin with a hyphen and could
be confused with the name of a command-line switch,
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    </span><span class="ConsoleText-element-syntax">$</span><span class="ConsoleText-plain-syntax"> </span><span class="ConsoleText-function-syntax">intest/Tangled/intest</span><span class="ConsoleText-identifier-syntax"> -from</span><span class="ConsoleText-plain-syntax"> PROJECT COMMAND</span>
</pre>
<p class="commentary"><span class="extract"><span class="ConsoleText-extract-syntax">PROJECT</span></span> is optional if the <span class="extract"><span class="ConsoleText-extract-syntax">COMMAND</span></span> is simply <span class="extract"><span class="ConsoleText-extract-syntax">-help</span></span> or <span class="extract"><span class="ConsoleText-extract-syntax">-version</span></span>,
when of course no actual testing will happen.
</p>

<p class="commentary">The rest of this section is entirely about how to write a <span class="extract"><span class="ConsoleText-extract-syntax">COMMAND</span></span>.
</p>

<p class="commentary firstcommentary"><a id="SP2"></a><b>&#167;2.  </b>Intest expects that <span class="extract"><span class="ConsoleText-extract-syntax">PROJECT</span></span> will be a directory, and that it will further
contain a subdirectory called <span class="extract"><span class="ConsoleText-extract-syntax">Tests</span></span>. But that is really the only assumption
it makes: there is no requirement for the project to be a web in the sense of
Inweb, or to be one of the Inform tools.
</p>

<p class="commentary firstcommentary"><a id="SP3"></a><b>&#167;3. History and substitution. </b>For each different project <span class="extract"><span class="ConsoleText-extract-syntax">PROJECT</span></span>, Intest maintains a history of recent
commands in a file stored at:
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    PROJECT/Tests/intest-history.txt</span>
</pre>
<p class="commentary">If Intest can't find this file, it silently continues; it will rewrite, or
create, this file when it exits, unless the <span class="extract"><span class="extract-syntax">-no-history</span></span> setting is used.
(When Intest is being used less interactively &mdash; for example, inside the
Inform user interface app &mdash; this setting avoids clutter.)
</p>

<p class="commentary">The first thing Intest does with a <span class="extract"><span class="extract-syntax">COMMAND</span></span> is to make substitutions.
A <span class="extract"><span class="extract-syntax">COMMAND</span></span> consisting of just "?" lists the project's current history, like so:
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    </span><span class="ConsoleText-element-syntax">$</span><span class="ConsoleText-plain-syntax"> </span><span class="ConsoleText-function-syntax">intest/Tangled/intest</span><span class="ConsoleText-plain-syntax"> inform7 ?</span>
<span class="ConsoleText-plain-syntax">    ?1. cases</span>
<span class="ConsoleText-plain-syntax">    ?2. Abolition</span>
<span class="ConsoleText-plain-syntax">    ?3. Beatles Sackcloth Gelato</span>
<span class="ConsoleText-plain-syntax">    ?4. problems</span>
<span class="ConsoleText-plain-syntax">    1 = PM_ActivityOf; 2 = PM_AdjectiveIsValue</span>
</pre>
<p class="commentary">(If there's no recorded history, output is empty.) What this means is that
there have been four previous commands, called <span class="extract"><span class="ConsoleText-extract-syntax">?1</span></span> to <span class="extract"><span class="ConsoleText-extract-syntax">?4</span></span>. There are also
two test cases recently found to be troublesome, called <span class="extract"><span class="ConsoleText-extract-syntax">1</span></span> and <span class="extract"><span class="ConsoleText-extract-syntax">2</span></span>. History
is maintained for the previous 20 commands.
</p>

<p class="commentary">Intest uses both of these notations to save typing. The command <span class="extract"><span class="ConsoleText-extract-syntax">?3</span></span>, for
example, abbreviates <span class="extract"><span class="ConsoleText-extract-syntax">Beatles Sackcloth Gelato</span></span>. Thus:
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    </span><span class="ConsoleText-element-syntax">$</span><span class="ConsoleText-plain-syntax"> </span><span class="ConsoleText-function-syntax">intest/Tangled/intest</span><span class="ConsoleText-plain-syntax"> inform7 ?3</span>
<span class="ConsoleText-plain-syntax">    Repeating: ?3. Beatles Sackcloth Gelato</span>
<span class="ConsoleText-plain-syntax">    ...</span>
</pre>
<p class="commentary">is equivalent to typing:
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    </span><span class="ConsoleText-element-syntax">$</span><span class="ConsoleText-plain-syntax"> </span><span class="ConsoleText-function-syntax">intest/Tangled/intest</span><span class="ConsoleText-plain-syntax"> inform7 Beatles Sackcloth Gelato</span>
</pre>
<p class="commentary">except that it doesn't add a new line to the history file, since this is a repeat of an old command, not a new one.
</p>

<p class="commentary">Calling intest with an empty command repeats its most recent new command:
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    </span><span class="ConsoleText-element-syntax">$</span><span class="ConsoleText-plain-syntax"> </span><span class="ConsoleText-function-syntax">intest/Tangled/intest</span><span class="ConsoleText-plain-syntax"> inform7</span>
<span class="ConsoleText-plain-syntax">    Repeating: ?4. problems</span>
<span class="ConsoleText-plain-syntax">    ...</span>
</pre>
<p class="commentary">Finally, intest automatically expands any command line arguments consisting
only of positive decimal numbers into the names recorded in the history. Thus
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    </span><span class="ConsoleText-element-syntax">$</span><span class="ConsoleText-plain-syntax"> </span><span class="ConsoleText-function-syntax">intest/Tangled/intest</span><span class="ConsoleText-plain-syntax"> inform7 1 2</span>
<span class="ConsoleText-plain-syntax">    Expanded to: ?5. PM_ActivityOf PM_AdjectiveIsValue</span>
<span class="ConsoleText-plain-syntax">    ...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP4"></a><b>&#167;4. Command line arguments. </b>At this point, then, the command no longer has any <span class="extract"><span class="ConsoleText-extract-syntax">?</span></span>, <span class="extract"><span class="ConsoleText-extract-syntax">?n</span></span> or <span class="extract"><span class="ConsoleText-extract-syntax">n</span></span> tokens
in it, because those have all been taken care of. What remains is a "raw
command". This takes the form:
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    OPTIONS -using USING -do DO</span>
</pre>
<p class="commentary"><span class="extract"><span class="extract-syntax">OPTIONS</span></span>, which can be nothing at all, sets overall switches such as
<span class="extract"><span class="extract-syntax">-no-history</span></span>. See below. <span class="extract"><span class="extract-syntax">-using</span></span> tells Intest where to find test cases;
that too is optional. <span class="extract"><span class="extract-syntax">-do</span></span> tells Intest which test cases to run. If there
isn't a <span class="extract"><span class="extract-syntax">-using</span></span> block, there's no need to say <span class="extract"><span class="extract-syntax">-do</span></span>, so simply
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    OPTIONS DO</span>
</pre>
<p class="commentary">will work. For example,
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    -no-history bigarrays badvariables</span>
</pre>
<p class="commentary">would set the option <span class="extract"><span class="extract-syntax">-no-history</span></span> and then perform a "do" on the two test
cases named.
</p>

<p class="commentary firstcommentary"><a id="SP5"></a><b>&#167;5. The options. </b>Are as follows:
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-history</span></span> and <span class="extract"><span class="extract-syntax">-no-history</span></span> turn the writing of command history on or off.
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-colours</span></span> and <span class="extract"><span class="extract-syntax">-no-colours</span></span> turn on or off the use of red and green terminal
text to show deletions and insertions when displaying differences.
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-verbose</span></span> and <span class="extract"><span class="extract-syntax">-no-verbose</span></span> turn on or off the echoing of shell commands to
the standard output. (Unlike make, Intest is by default silent.)
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-threads=N</span></span> tells Intest to use up to <span class="extract"><span class="extract-syntax">N</span></span> independent threads, with one test
at a time running on each thread. Experience shows that setting <span class="extract"><span class="extract-syntax">N</span></span> to be
the number of processor cores you have, doubling if you have hyperthreading,
gives the fastest performance. <span class="extract"><span class="extract-syntax">-threads=1</span></span> makes Intest run in a single
thread, which may be necessary on some platforms.
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-purge</span></span> is an option used only when testing Inform 7; it's a convenience for
removing the many temporary files created in the course of testing.
</p>

<p class="commentary firstcommentary"><a id="SP6"></a><b>&#167;6. Using. </b>Before it can do any testing, Intest has to discover the universe of possible
named test cases available, and work out which recipe to use with each.
</p>

<p class="commentary">It normally does that by reading a recipe file stored at:
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    PROJECT/Tests/PROJECT.intest</span>
</pre>
<p class="commentary">This is because the default <span class="extract"><span class="extract-syntax">-using</span></span> setting is
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    -using PROJECT/Tests/PROJECT.intest</span>
</pre>
<p class="commentary">You can alternatively say <span class="extract"><span class="extract-syntax">-using R</span></span> for any recipe file <span class="extract"><span class="extract-syntax">R</span></span>, which need not
be in the project folder.
</p>

<p class="commentary">It is also possible, though seldom useful, to give your recipe instructions
at the command line and not in a recipe file at all. Newcomers to Intest
should simply skip the following discussion, but:
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    -using USE1 USE2 ... USEn</span>
</pre>
<p class="commentary">can instead be a list of use commands, some of a single token, some of
two or more. These can be:
</p>

<ul class="items"><li>(a) <span class="extract"><span class="extract-syntax">-if P</span></span>, where <span class="extract"><span class="extract-syntax">P</span></span> is a platform name, such as "windows". Act on the
succeeding use commands only if the platform is <span class="extract"><span class="extract-syntax">P</span></span>.
</li><li>(b) <span class="extract"><span class="extract-syntax">-endif</span></span>. Go back to always acting on use commands.
</li><li>(c) <span class="extract"><span class="extract-syntax">-set VAR VALUE</span></span>. Set the given variable to the given value.
</li><li>(d) <span class="extract"><span class="extract-syntax">-groups PATH</span></span>. Sets the groups directory to the given pathname;
failing which, any <span class="extract"><span class="extract-syntax">.testgrpup</span></span> files (see below) are looked for in the
currently seleced directory.
</li><li>(e) <span class="extract"><span class="extract-syntax">[NAME]</span></span>. Sets the test recipe to be used for the cases about to be
discovered. All recipe names are in square brackets; the default is just
<span class="extract"><span class="extract-syntax">[Recipe]</span></span>.
</li><li>(f) A choice of test case type: <span class="extract"><span class="extract-syntax">-extension</span></span>, <span class="extract"><span class="extract-syntax">-case</span></span>, <span class="extract"><span class="extract-syntax">-problem</span></span>, <span class="extract"><span class="extract-syntax">-map</span></span>
or <span class="extract"><span class="extract-syntax">-example</span></span>. This indicates that the next run of tokens will be
filenames of individual test cases of that type.
</li><li>(g) A pluralised choice of these: <span class="extract"><span class="extract-syntax">-extensions</span></span>, <span class="extract"><span class="extract-syntax">-cases</span></span>, <span class="extract"><span class="extract-syntax">-problems</span></span>,
<span class="extract"><span class="extract-syntax">-maps</span></span> or <span class="extract"><span class="extract-syntax">-examples</span></span>. This indicates that the next run of tokens will be
pathnames of directories holding multiple test cases of that type.
</li><li>(h) A filename or directory name. Look here for test cases of the current
type, and assign them the current recipe.
</li></ul>
<p class="commentary">(Test types, and what it means to scan a directory for test cases, will be
gone into in the next section.)
</p>

<p class="commentary firstcommentary"><a id="SP7"></a><b>&#167;7. Doing. </b>The "doing" part of an Intest command is usually a list of test cases to
be tried. For example,
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    alpha beta gamma</span>
</pre>
<p class="commentary">is implicitly read as
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    -test alpha beta gamma</span>
</pre>
<p class="commentary">since <span class="extract"><span class="extract-syntax">-test</span></span> is understood if no other do command is given.
</p>

<p class="commentary">Any number of names can be supplied, each of which must be one of the
following:
</p>

<ul class="items"><li>(i) <span class="extract"><span class="extract-syntax">all</span></span> means all known tests;
</li><li>(ii) <span class="extract"><span class="extract-syntax">examples</span></span>, <span class="extract"><span class="extract-syntax">extensions</span></span>, <span class="extract"><span class="extract-syntax">problems</span></span>, <span class="extract"><span class="extract-syntax">cases</span></span>, <span class="extract"><span class="extract-syntax">maps</span></span> each mean all
known tests of the given type of origin;
</li><li>(iii) <span class="extract"><span class="extract-syntax">A</span></span>, <span class="extract"><span class="extract-syntax">B</span></span>, <span class="extract"><span class="extract-syntax">C</span></span>, ..., mean "the example with this letter in the (first)
extension case";
</li><li>(iv) <span class="extract"><span class="extract-syntax">^1</span></span>, <span class="extract"><span class="extract-syntax">^2</span></span>, <span class="extract"><span class="extract-syntax">^3</span></span>, ..., mean "the 1st (2nd, 3rd, ...) test case known",
&mdash; this is not to be confused with the <span class="extract"><span class="extract-syntax">1</span></span>, <span class="extract"><span class="extract-syntax">2</span></span>, <span class="extract"><span class="extract-syntax">3</span></span>, ... notation used
to call back previously failed cases: typically <span class="extract"><span class="extract-syntax">^1</span></span> will be the first
test case alphabetically;
</li><li>(v) a name containing a <span class="extract"><span class="extract-syntax">%</span></span> character will be treated as a regular expression,
in the same notation as for <span class="extract"><span class="extract-syntax">-find</span></span> (see below) - for example, <span class="extract"><span class="extract-syntax">BIP-%c+</span></span>
will mean "any test case whose name or title begins with <span class="extract"><span class="extract-syntax">BIP-</span></span>";
</li><li>(vi) a name beginning with a <span class="extract"><span class="extract-syntax">:</span></span> will be treated as a "group", and will
run all tests in that group &mdash; which is to say, the ones listed in the
group's file: <span class="extract"><span class="extract-syntax">:wrangly</span></span> will run all tests listed in <span class="extract"><span class="extract-syntax">wrangly.testgroup</span></span>,
multithreaded, whereas a double colon <span class="extract"><span class="extract-syntax">::wrangly</span></span> runs them one at a time;
</li><li>(vii) and finally, of course, an explicit test case name refers to that test case.
</li></ul>
<p class="commentary">(Test types will be gone into in the next section.)
</p>

<p class="commentary firstcommentary"><a id="SP8"></a><b>&#167;8.  </b>But other do commands are also available:
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-catalogue</span></span>: List all the known test cases. For large projects this might
produce an enormous list, but <span class="extract"><span class="extract-syntax">-using</span></span> can cut that down. To give an example
from Inform,
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    </span><span class="ConsoleText-element-syntax">$</span><span class="ConsoleText-plain-syntax"> </span><span class="ConsoleText-function-syntax">intest/Tangled/intest</span><span class="ConsoleText-plain-syntax"> inform7</span><span class="ConsoleText-identifier-syntax"> -using -extension</span><span class="ConsoleText-plain-syntax"> 'inform7/Internal/Extensions/Emily Short/Locksmith.i7x'</span><span class="ConsoleText-identifier-syntax"> -do -catalogue</span>
<span class="ConsoleText-plain-syntax">    Locksmith Example A = John Malkovich's Toilet</span>
<span class="ConsoleText-plain-syntax">    Locksmith Example B = Tobacco</span>
<span class="ConsoleText-plain-syntax">    Locksmith Example C = Rekeying</span>
<span class="ConsoleText-plain-syntax">    Locksmith Example D = Watchtower</span>
</pre>
<p class="commentary">Here the universe of possible tests is reduced to just those which are given
in the documentation for this specific Inform extension. The <span class="extract"><span class="ConsoleText-extract-syntax">-catalogue</span></span>
then gives a full list of those four.
</p>

<p class="commentary"><span class="extract"><span class="ConsoleText-extract-syntax">-find &lt;text&gt;</span></span>: List all the known test cases whose case names or story
titles match <span class="extract"><span class="ConsoleText-extract-syntax">&lt;text&gt;</span></span>. This can in fact be a regular expression, using
<span class="extract"><span class="ConsoleText-extract-syntax">[...]</span></span>, <span class="extract"><span class="ConsoleText-extract-syntax">%c</span></span> for any character (not <span class="extract"><span class="ConsoleText-extract-syntax">.</span></span>), <span class="extract"><span class="ConsoleText-extract-syntax">%C</span></span> for any non-white-space, <span class="extract"><span class="ConsoleText-extract-syntax">%d</span></span>
for a digit, and so on. For example:
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    </span><span class="ConsoleText-element-syntax">$</span><span class="ConsoleText-plain-syntax"> </span><span class="ConsoleText-function-syntax">intest/Tangled/intest</span><span class="ConsoleText-plain-syntax"> inform7</span><span class="ConsoleText-identifier-syntax"> -find</span><span class="ConsoleText-plain-syntax"> %d%d%d%d</span>
<span class="ConsoleText-plain-syntax">    Test cases matching '%d%d%d%d':</span>
<span class="ConsoleText-plain-syntax">    Jamaica1688 = Jamaica 1688</span>
<span class="ConsoleText-plain-syntax">    Mapped = 1691</span>
<span class="ConsoleText-plain-syntax">    Royal = 1691</span>
<span class="ConsoleText-plain-syntax">    Royal2 = 1691</span>
<span class="ConsoleText-plain-syntax">    Royal3 = 1691</span>
<span class="ConsoleText-plain-syntax">    SP = Space Patrol #57 - 1953-10-31 - Stranded on Jupiter!</span>
<span class="ConsoleText-plain-syntax">    Stoppers = Trachypachidae Maturin 1803</span>
</pre>
<p class="commentary">(The reason for the equals signs here, and in the above example too, is that
an individual test case can have both a "name" &mdash; such as <span class="extract"><span class="ConsoleText-extract-syntax">Stoppers</span></span> &mdash; and also
a "title" &mdash; such as "Trachypachidae Maturin 1803". The name is derived from
its filename. The title will only exist for cases extracted from Inform
example or extension files, and then it's the title of the story making up
the test case.)
</p>

<p class="commentary"><span class="extract"><span class="ConsoleText-extract-syntax">-source &lt;cases&gt;</span></span>: Output the contents of the test cases. This sounds
as if it does no more than printing out their source files, but it's a
non-trivial operation for some Inform test cases (those occurring as examples
or in extensions).
</p>

<p class="commentary"><span class="extract"><span class="ConsoleText-extract-syntax">-script &lt;cases&gt;</span></span>: This is relevant only for testing Inform. Output the
script of player inputs to be used when running the story file produced
by compiling this test case; the script being drawn from the
</p>

<blockquote>
    <p>Test me with "...".</p>
</blockquote>

<p class="commentary">line inside the source, if one is present. If no script is there, this
produces empty output, but does not throw an error. For example:
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    </span><span class="ConsoleText-element-syntax">$</span><span class="ConsoleText-plain-syntax"> </span><span class="ConsoleText-function-syntax">intest</span><span class="ConsoleText-identifier-syntax"> -using -extension</span><span class="ConsoleText-plain-syntax"> 'inform7/Internal/Extensions/Emily Short/Locksmith.i7x'</span><span class="ConsoleText-identifier-syntax"> -do -script</span><span class="ConsoleText-plain-syntax"> C</span>
<span class="ConsoleText-plain-syntax">    i</span>
<span class="ConsoleText-plain-syntax">    x key</span>
<span class="ConsoleText-plain-syntax">    unlock box</span>
<span class="ConsoleText-plain-syntax">    i</span>
<span class="ConsoleText-plain-syntax">    x key</span>
</pre>
<p class="commentary">which is the command script for Example C of Locksmith:
</p>

<p class="commentary"><span class="extract"><span class="ConsoleText-extract-syntax">-concordance &lt;cases&gt;</span></span>: Output a concordance table for comparing line numbers
between the source text extracted by Intest vs. the original file they came
from. This is a sequence of lines of the form:
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    1 +404</span>
</pre>
<p class="commentary">which means "from line 1 of the extracted output onwards, you have to add
404 to get the corresponding line of the original from which it came". There can
be any number of such lines, including none at all (which means: the line
numbers match); e.g.
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    1 +404</span>
<span class="plain-syntax">    21 +409</span>
</pre>
<p class="commentary">means add 404 to lines 1 to 20, then add 409 from then on, presumably because
5 lines have been skipped. The list is always of minimal length and any offsets
quoted are always positive, so <span class="extract"><span class="extract-syntax">+0</span></span> or <span class="extract"><span class="extract-syntax">+-7</span></span> can't occur.
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-bless &lt;cases&gt;</span></span>: Test and then, if the case is cursed, bless the transcript
as correct. (If the case is already blessed, nothing changes.)
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-rebless &lt;cases&gt;</span></span>: Test and then bless the transcript as correct, replacing
any existing blessed transcript: equivalent to <span class="extract"><span class="extract-syntax">-curse</span></span> followed by <span class="extract"><span class="extract-syntax">-bless</span></span>.
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-curse &lt;cases&gt;</span></span>: Delete the blessed transcript for these cases. (Alas,
there's no such thing as <span class="extract"><span class="extract-syntax">-recurse</span></span>.)
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-show &lt;cases&gt;</span></span>: Run a test just as far as the first <span class="extract"><span class="extract-syntax">show</span></span> step in its recipe,
and then print out the file specified. For most recipes, this prints out, say,
the console output generated by the program being tested.
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-show-i6 &lt;cases&gt;</span></span>: Run a test just as far as taking it through the I6 compiler stage, and show the console output from I6. (This is for Inform only.)
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-show-t &lt;cases&gt;</span></span>: Run a test, and show the transcript of play from the
resulting story file. (This is for Inform only.)
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-debug &lt;cases&gt;</span></span>: Run a test, but when you get to the Inform 7 compiler stage, run it in the <span class="extract"><span class="extract-syntax">lldb</span></span> debugger and do not redirect <span class="extract"><span class="extract-syntax">stdout</span></span> or <span class="extract"><span class="extract-syntax">stderr</span></span>. (This is for Inform only.)
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-open &lt;cases&gt;</span></span>: Call the shell command <span class="extract"><span class="extract-syntax">open</span></span> on the file(s) from which the source text of these case(s) are drawn. On MacOS, for example, this is equivalent to double-clicking them in the Finder, and likely means they will open in the default text editor.
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-diff &lt;cases&gt;</span></span>: Test and then, if a <span class="extract"><span class="extract-syntax">match</span></span> step fails in its recipe, run
the shell command <span class="extract"><span class="extract-syntax">diff</span></span> on the actual versus ideal versions of the output
being matched.
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">-bbdiff &lt;cases&gt;</span></span>: Like <span class="extract"><span class="extract-syntax">-diff</span></span>, but using the <span class="extract"><span class="extract-syntax">bbdiff</span></span> tool instead. You will only have this if you're running the BBEdit text editor on MacOS.
</p>

<p class="commentary firstcommentary"><a id="SP9"></a><b>&#167;9. Output redirection. </b>Do commands producing textual output, such as <span class="extract"><span class="extract-syntax">-source</span></span>, normally send that to
the standard output stdout. (If you're using Intest in a <span class="extract"><span class="extract-syntax">bash</span></span> or similar
shell on a Unix-based operating system, this means it can be piped to an
application or redirected to a file.) But you can also ask Intest itself to
redirect the output, since any action can optionally be followed by
<span class="extract"><span class="extract-syntax">-to &lt;filename&gt;</span></span>.
</p>

<p class="commentary">This redirects output to the given file, which is created (and overwrites any
file already existing with that name). In a <span class="extract"><span class="extract-syntax">-to</span></span> destination, any usage in
the filename of the text <span class="extract"><span class="extract-syntax">[NAME]</span></span> expands to the name of the test case; any
usage of <span class="extract"><span class="extract-syntax">[NUMBER]</span></span> expands to a unique integer, counting upwards from 1, for
each test case being applied to by this action. Thus, for example:
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    -source A B C D -to source_[NAME].txt</span>
</pre>
<p class="commentary">might write four files, called, say,
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    source_Locksmith Example A.txt</span>
<span class="plain-syntax">    source_Locksmith Example B.txt</span>
<span class="plain-syntax">    source_Locksmith Example C.txt</span>
<span class="plain-syntax">    source_Locksmith Example D.txt</span>
</pre>
<p class="commentary">Note that if you write multiple do commands, they can each have independent
<span class="extract"><span class="extract-syntax">-to</span></span> destinations.
</p>

<p class="commentary firstcommentary"><a id="SP10"></a><b>&#167;10. Reporting on test outcomes in the Inform app. </b>Two special do commands are provided for use of the Inform app only (well,
it's hard to think of anyone else who would need them). The idea here is that
after the Inform app has conducted a test, it asks intest to produce an HTML
page to describe the results of the test, passing over the information needed
to do this:
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    -report &lt;case&gt; &lt;code&gt; &lt;problems-file&gt; &lt;skein-file&gt;</span>
</pre>
<p class="commentary">Here <span class="extract"><span class="extract-syntax">&lt;case&gt;</span></span> is a single case, not a list, and <span class="extract"><span class="extract-syntax">&lt;code&gt;</span></span> is one of:
</p>

<ul class="items"><li>(a) <span class="extract"><span class="extract-syntax">i7</span></span>: meaning, failed i7, i.e., <span class="extract"><span class="extract-syntax">inform7</span></span> produced problem messages
</li><li>(b) <span class="extract"><span class="extract-syntax">i6</span></span>: meaning, failed to compile in i6
</li><li>(c) <span class="extract"><span class="extract-syntax">wrong</span></span>: meaning, the story file compiled and started, but the transcript didn't match its blessed version
</li><li>(d) <span class="extract"><span class="extract-syntax">right</span></span>: meaning, a success: story file compiled and started, and matched transcript
</li></ul>
<p class="commentary"><span class="extract"><span class="extract-syntax">&lt;problems-file&gt;</span></span> is the file generated by <span class="extract"><span class="extract-syntax">inform7</span></span>, in the event of either success or failure, which is usually stored in the project's <span class="extract"><span class="extract-syntax">Build/Problems.html</span></span>.
</p>

<p class="commentary"><span class="extract"><span class="extract-syntax">&lt;skein-file&gt;</span></span> is only looked at (potentially) in case (c), and is the skein file for the example in question; at present it's ignored.
</p>

<p class="commentary">For example:
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    </span><span class="ConsoleText-element-syntax">$</span><span class="ConsoleText-plain-syntax"> </span><span class="ConsoleText-function-syntax">intest/Tangled/intest</span><span class="ConsoleText-plain-syntax"> inform7</span>
<span class="ConsoleText-plain-syntax">        -using -extension Locksmith.i7xp/Source/extension.i7x</span>
<span class="ConsoleText-plain-syntax">        -do -report C i7 Locksmith.i7xp/Build/Problems.html Locksmith.i7xp/Skein.skein</span>
</pre>
<p class="commentary">reports on the failure of example C from the <span class="extract"><span class="ConsoleText-extract-syntax">Locksmith.i7xp</span></span> project. The
output is HTML, but sent to stdout by default; use something like
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    -to Locksmith.i7xp/Build/Problems-3.html</span>
</pre>
<p class="commentary">to redirect this to a particular file.
</p>

<p class="commentary">The second special action is <span class="extract"><span class="ConsoleText-extract-syntax">-combine</span></span>. This assumes that the Inform app has
already performed <span class="extract"><span class="ConsoleText-extract-syntax">N</span></span> such tests, where <span class="extract"><span class="ConsoleText-extract-syntax">N &gt;= 1</span></span>, and has called Intest with
the <span class="extract"><span class="ConsoleText-extract-syntax">-report</span></span> action on each in turn, redirecting the output to a series of
files. What <span class="extract"><span class="ConsoleText-extract-syntax">-combine</span></span> does is to read all of those files in and merge them
into a consolidated report, which, once again, it writes as HTML. The format
here is:
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    -combine &lt;base-filename&gt; -&lt;N&gt;</span>
</pre>
<p class="commentary">The filenames of the individual reports are assumed to be <span class="extract"><span class="extract-syntax">&lt;base-filename&gt;</span></span>
but with "-1", "-2", ..., tacked on before the file extension. Thus:
</p>

<pre class="ConsoleText-displayed-code all-displayed-code code-font">
<span class="ConsoleText-plain-syntax">    </span><span class="ConsoleText-element-syntax">$</span><span class="ConsoleText-plain-syntax"> </span><span class="ConsoleText-function-syntax">intest</span><span class="ConsoleText-identifier-syntax"> -using -extension</span><span class="ConsoleText-plain-syntax"> Locksmith.i7xp/Source/extension.i7x</span>
<span class="ConsoleText-plain-syntax">        -do -combine Locksmith.i7xp/Build/Problems.html -4</span>
<span class="ConsoleText-plain-syntax">        -to Locksmith.i7xp/Build/Consolidated.html</span>
</pre>
<p class="commentary">reads in
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    Locksmith.i7xp/Build/Problems-1.html</span>
<span class="plain-syntax">    Locksmith.i7xp/Build/Problems-2.html</span>
<span class="plain-syntax">    Locksmith.i7xp/Build/Problems-3.html</span>
<span class="plain-syntax">    Locksmith.i7xp/Build/Problems-4.html</span>
</pre>
<p class="commentary">and writes out a consolidated report into
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    Locksmith.i7xp/Build/Consolidated.html</span>
</pre>
<p class="commentary firstcommentary"><a id="SP11"></a><b>&#167;11. Skein file testing. </b>In order to be used by the Testing panel in the Inform app, intest also supports the following:
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="plain-syntax">    -test-skein &lt;file&gt; &lt;node-id&gt;</span>
</pre>
<p class="commentary">This reads the specified <span class="extract"><span class="extract-syntax">.skein</span></span> file, looks for the node in it with the given ID, and runs intest's diff algorithm on the actual versus blessed transcript at that node. The output is in simple HTML format.
</p>

<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="M-iti.html">&#10094;</a></li><li class="progresscurrentchapter">M</li><li class="progresssection"><a href="M-iti.html">iti</a></li><li class="progresscurrent">iatcl</li><li class="progresssection"><a href="M-wir.html">wir</a></li><li class="progresssection"><a href="M-rc.html">rc</a></li><li class="progresschapter"><a href="P-htpw.html">P</a></li><li class="progresschapter"><a href="1-bsc.html">1</a></li><li class="progresschapter"><a href="2-rf.html">2</a></li><li class="progresschapter"><a href="3-ts.html">3</a></li><li class="progresschapter"><a href="4-tdc.html">4</a></li><li class="progressnext"><a href="M-wir.html">&#10095;</a></li></ul></div>
</nav><!--End of weave-->

		</main>
	</body>
</html>

